<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>小楼一夜听春雨</title>
    <link>https://b.qqbb.app/</link>
    <description>Recent content on 小楼一夜听春雨</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    <managingEditor>273412935@qq.com (龙哥)</managingEditor>
    <webMaster>273412935@qq.com (龙哥)</webMaster>
    <copyright>圆月弯刀</copyright>
    <lastBuildDate>Sat, 16 Feb 2019 00:00:00 +0800</lastBuildDate>
    
        <atom:link href="https://b.qqbb.app/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>health</title>
      <link>https://b.qqbb.app/post/note-about-health/</link>
      <pubDate>Sat, 16 Feb 2019 00:00:00 +0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/note-about-health/</guid>
      
        <description>

&lt;h2 id=&#34;健身前&#34;&gt;健身前&lt;/h2&gt;

&lt;h3 id=&#34;热身&#34;&gt;热身&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;充分热身，如：拉伸身体各部位。&lt;/li&gt;
&lt;li&gt;部分运动，请找好队友。如：卧推。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;心态&#34;&gt;心态&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;告诉自己：自我感觉身体不适，请停止运动。&lt;/li&gt;
&lt;li&gt;健康是一个长期的过程。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;这里有多层意思，至少有：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;不要想着一天就能增长好多肌肉或减少好多脂肪，这不可能。&lt;/li&gt;
&lt;li&gt;坚持（这个是世界上最难的事情）。&lt;/li&gt;
&lt;li&gt;要以健康为中心。任何不以健康为中心的健身，都是伪健身。&lt;/li&gt;
&lt;li&gt;尽量避免运动中受伤(这也是个很难的事情)。&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;健身中&#34;&gt;健身中&lt;/h2&gt;

&lt;h3 id=&#34;增肌&#34;&gt;增肌&lt;/h3&gt;

&lt;h4 id=&#34;大肌肉群为主&#34;&gt;大肌肉群为主&lt;/h4&gt;

&lt;p&gt;杠铃，哑铃, 卧推&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;12次*4组模式&lt;/li&gt;
&lt;li&gt;力竭*4组模式&lt;/li&gt;
&lt;li&gt;单组能达50次，请进阶，加难度&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;呼吸&#34;&gt;呼吸&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;不可憋气。&lt;/li&gt;
&lt;li&gt;出吐回吸。俯卧撑：下去，靠近地面，吐气；回来，靠近天空，吸气。&lt;/li&gt;
&lt;li&gt;会有特殊情况，则有不同。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;减脂&#34;&gt;减脂&lt;/h3&gt;

&lt;h4 id=&#34;有氧运动为主&#34;&gt;有氧运动为主&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;跑步是一个好方式。&lt;/li&gt;
&lt;li&gt;心率的50-85%&lt;/li&gt;
&lt;li&gt;持续不断20分钟&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;健身后&#34;&gt;健身后&lt;/h2&gt;

&lt;h3 id=&#34;0-5分钟&#34;&gt;0-5分钟&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;慢走&lt;/li&gt;
&lt;li&gt;放松体操&lt;/li&gt;
&lt;li&gt;小动一下&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;不可以的事：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;不宜洗澡&lt;/li&gt;
&lt;li&gt;不宜立即吸烟&lt;/li&gt;
&lt;li&gt;不宜贪吃冷饮&lt;/li&gt;
&lt;li&gt;不宜蹲坐&lt;/li&gt;
&lt;li&gt;不宜吃饭&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;健身结束后应该调整呼吸节奏，进行一些低热量的活动，比如说慢走，做几节放松体操或者说是进行简单的深呼吸，促进四肢血液能够回流心脏，这样有利于我们还清欠下的“氧债”，能够加快恢复身体机能，消除疲劳。&lt;/p&gt;

&lt;h3 id=&#34;5-20分钟&#34;&gt;5-20分钟&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;可坐可蹲了&lt;/li&gt;
&lt;li&gt;小口多次喝水，不能喝多&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;不可以的事：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;不宜洗澡&lt;/li&gt;
&lt;li&gt;不宜立即吸烟&lt;/li&gt;
&lt;li&gt;不宜贪吃冷饮&lt;/li&gt;
&lt;li&gt;不宜吃饭&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;20-30分钟&#34;&gt;20-30分钟&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;宜洗澡&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;30-60分钟&#34;&gt;30-60分钟&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;洗澡。优先泡澡，再次淋浴&lt;/li&gt;
&lt;li&gt;进食。先吃碳水化合物，再蛋白类。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;60-120分钟&#34;&gt;60-120分钟&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;休息&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;运动了，很累的，让身体停下来。&lt;/p&gt;

&lt;h2 id=&#34;进食&#34;&gt;进食&lt;/h2&gt;

&lt;h3 id=&#34;健身中进食&#34;&gt;健身中进食&lt;/h3&gt;

&lt;p&gt;在训练过程中碳水化各物的补充尤为重要，特别是减脂。&lt;/p&gt;

&lt;h3 id=&#34;注意&#34;&gt;注意&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;如果先进食，则进食后20分钟内不可以洗澡。&lt;/li&gt;
&lt;li&gt;多蒸煮，少油。多蛋白，少辣椒。&lt;/li&gt;
&lt;li&gt;少吃多餐。（最少一天要吃5顿，有条件8顿以上。早餐必吃）&lt;/li&gt;
&lt;li&gt;晚餐不能大吃特吃&lt;/li&gt;
&lt;li&gt;细嚼慢咽&lt;/li&gt;
&lt;li&gt;重视蛋白质（一般人：体重公斤*1.1克，增股：体重公斤*2克）&lt;/li&gt;
&lt;li&gt;每天要喝大量的白开水（不是饮料）&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;推荐食材&#34;&gt;推荐食材&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;牛肉，鸡胸肉，羊肉（均为瘦肉）&lt;/li&gt;
&lt;li&gt;鸡蛋(蛋白可多个，蛋黄不多于2个，且蛋黄要相互分开1小时吃)&lt;/li&gt;
&lt;li&gt;酸奶，全脂奶&lt;/li&gt;
&lt;li&gt;苹果汁(鲜榨)&lt;/li&gt;
&lt;li&gt;白面包，意大利面&lt;/li&gt;
&lt;li&gt;三文鱼，各种鱼&lt;/li&gt;
&lt;li&gt;香蕉, 牛油果&lt;/li&gt;
&lt;li&gt;橄榄油&lt;/li&gt;
&lt;li&gt;地瓜&lt;/li&gt;
&lt;li&gt;燕麦&lt;/li&gt;
&lt;li&gt;紫菜&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>gitbook（笔记）</title>
      <link>https://b.qqbb.app/post/note-about-gitbook/</link>
      <pubDate>Fri, 15 Feb 2019 00:00:00 +0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/note-about-gitbook/</guid>
      
        <description>

&lt;h2 id=&#34;入门&#34;&gt;入门&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/fa38ef97431d&#34;&gt;https://www.jianshu.com/p/fa38ef97431d&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://segmentfault.com/a/1190000011440899&#34;&gt;https://segmentfault.com/a/1190000011440899&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/b0a11b9b8725&#34;&gt;https://www.jianshu.com/p/b0a11b9b8725&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/09a1cac0a0d0&#34;&gt;https://www.jianshu.com/p/09a1cac0a0d0&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;初步&#34;&gt;初步&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.ituring.com.cn/article/127744&#34;&gt;http://www.ituring.com.cn/article/127744&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;进阶&#34;&gt;进阶&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.chengweiyang.cn/gitbook/github-pages/README.html&#34;&gt;http://www.chengweiyang.cn/gitbook/github-pages/README.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;ref&#34;&gt;Ref&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.imooc.com/article/details/id/30528&#34;&gt;https://www.imooc.com/article/details/id/30528&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>nodejs 一定要通过 nvm安装</title>
      <link>https://b.qqbb.app/post/nodejs-install/</link>
      <pubDate>Wed, 13 Feb 2019 00:00:00 +0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/nodejs-install/</guid>
      
        <description>

&lt;p&gt;使用 nvm 管理不同版本的 node 与 npm&lt;/p&gt;

&lt;h2 id=&#34;step&#34;&gt;step&lt;/h2&gt;

&lt;p&gt;补充说明：Mac 下通过 brew install nvm 所安装的 nvm ，由于安装路径不同，无法正确启用。建议使用 brew uninstall nvm 卸载掉之后，通过本文的方案重新安装一次。&lt;/p&gt;

&lt;p&gt;nvm 是 Mac 下的 node 管理工具，有点类似管理 Ruby 的 rvm，如果是需要管理 Windows 下的 node，官方推荐是使用 nvmw 或 nvm-windows 。&lt;/p&gt;

&lt;p&gt;以下具体说下 Mac 系统中的安装与使用细节（Windows 系统仅供类比参考）。&lt;/p&gt;

&lt;h2 id=&#34;一-卸载已安装到全局的-node-npm&#34;&gt;一、卸载已安装到全局的 node/npm&lt;/h2&gt;

&lt;p&gt;如果之前是在官网下载的 node 安装包，运行后会自动安装在全局目录，其中&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;node 命令在 `/usr/local/bin/node`&lt;/li&gt;
&lt;li&gt;npm 命令在 `/usr/local/bin/npm` ，其实是 `/usr/local/lib/node_modules/npm/bin/npm-cli.js` 的软链接&lt;/li&gt;
&lt;li&gt;全局 node_modules 目录在 `/usr/local/lib/node_modules/`&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;安装 nvm 之后最好先删除下已安装的 node 和全局 node 模块：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;npm ls -g --depth&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#查看已经安装在全局的模块，以便删除这些全局模块后再按照不同的 node 版本重新进行全局安装
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
sudo rm -rf /usr/local/lib/node_modules &lt;span class=&#34;c1&#34;&gt;#删除全局 node_modules 目录
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;sudo rm /usr/local/bin/node &lt;span class=&#34;c1&#34;&gt;#删除 node
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt;  /usr/local/bin &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; ls -l &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; grep &lt;span class=&#34;s2&#34;&gt;&amp;#34;../lib/node_modules/&amp;#34;&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; awk &lt;span class=&#34;s1&#34;&gt;&amp;#39;{print $9}&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; xargs rm #删除全局 node 模块注册的软链&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;二-安装-nvm&#34;&gt;二、安装 nvm&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.29.0/install.sh &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; bash&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;安装完成后请重新打开终端环境，Mac 下推荐使用 oh-my-zsh 代替默认的 bash shell。&lt;/p&gt;

&lt;h2 id=&#34;三-安装切换各版本-node-npm&#34;&gt;三、安装切换各版本 node/npm&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;nvm install stable &lt;span class=&#34;c1&#34;&gt;#安装最新稳定版 node，现在是 5.0.0
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;nvm install &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;.2.2 &lt;span class=&#34;c1&#34;&gt;#安装 4.2.2 版本
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;nvm install &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.12.7 &lt;span class=&#34;c1&#34;&gt;#安装 0.12.7 版本
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# 特别说明：以下模块安装仅供演示说明，并非必须安装模块
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;nvm use &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#切换至 0.12.7 版本
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;npm install -g mz-fis &lt;span class=&#34;c1&#34;&gt;#安装 mz-fis 模块至全局目录，安装完成的路径是 /Users/&amp;lt;你的用户名&amp;gt;/.nvm/versions/node/v0.12.7/lib/mz-fis
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;nvm use &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; &lt;span class=&#34;c1&#34;&gt;#切换至 4.2.2 版本
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;npm install -g react-native-cli &lt;span class=&#34;c1&#34;&gt;#安装 react-native-cli 模块至全局目录，安装完成的路径是 /Users/&amp;lt;你的用户名&amp;gt;/.nvm/versions/node/v4.2.2/lib/react-native-cli
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;
nvm &lt;span class=&#34;nb&#34;&gt;alias&lt;/span&gt; default &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.12.7 #设置默认 node 版本为 &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.12.7&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;四-使用-dot-nvmrc-文件配置项目所使用的-node-版本&#34;&gt;四、使用 .nvmrc 文件配置项目所使用的 node 版本&lt;/h2&gt;

&lt;p&gt;如果你的默认 node 版本（通过 nvm alias 命令设置的）与项目所需的版本不同，则可在项目根目录或其任意父级目录中创建 .nvmrc 文件，在文件中指定使用的 node 版本号，例如：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;nb&#34;&gt;cd&lt;/span&gt; &amp;lt;项目根目录&amp;gt;  &lt;span class=&#34;c1&#34;&gt;#进入项目根目录
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; &amp;gt; .nvmrc &lt;span class=&#34;c1&#34;&gt;#添加 .nvmrc 文件
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;nvm use &lt;span class=&#34;c1&#34;&gt;#无需指定版本号，会自动使用 .nvmrc 文件中配置的版本
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;node -v #查看 node 是否切换为对应版本&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;五-nvm-与-n-的区别&#34;&gt;五、nvm 与 n 的区别&lt;/h2&gt;

&lt;p&gt;node 版本管理工具还有一个是 TJ 大神的 n 命令，n 命令是作为一个 node 的模块而存在，而 nvm 是一个独立于 node/npm 的外部 shell 脚本，因此 n 命令相比 nvm 更加局限。&lt;/p&gt;

&lt;p&gt;由于 npm 安装的模块路径均为 /usr/local/lib/node_modules ，当使用 n 切换不同的 node 版本时，实际上会共用全局的 node/npm 目录。 因此不能很好的满足『按不同 node 版本使用不同全局 node 模块』的需求。&lt;/p&gt;

&lt;p&gt;因此建议各位尽早开始使用 nvm ，以免出现全局模块无法更新的问题。&lt;/p&gt;

&lt;p&gt;当然，如果你用的是 windows 操作系统，我只能说 …… 朋友，能不能早点换个 Mac&lt;/p&gt;

&lt;h2 id=&#34;ref&#34;&gt;Ref&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://www.cnblogs.com/kaiye/p/4937191.html&#34;&gt;http://www.cnblogs.com/kaiye/p/4937191.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>eslint入门</title>
      <link>https://b.qqbb.app/post/eslint-install/</link>
      <pubDate>Sun, 10 Feb 2019 00:00:00 +0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/eslint-install/</guid>
      
        <description>

&lt;h2 id=&#34;安装&#34;&gt;安装&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;npm install -g eslint babel-eslint eslint-plugin-react eslint-config-airbnb&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;在安装的时候得注意一点，eslint与eslint-config-airbnb要么都执行全局安装，要么都本地安装，必须相同哟。&lt;/p&gt;

&lt;p&gt;然后，把 &lt;a href=&#34;https://github.com/airbnb/javascript/blob/master/linters/.eslintrc&#34;&gt;https://github.com/airbnb/javascript/blob/master/linters/.eslintrc&lt;/a&gt; 下载到Project 中就可以了。&lt;/p&gt;

&lt;h2 id=&#34;使用&#34;&gt;使用&lt;/h2&gt;

&lt;p&gt;配置完相关信息后，就可以切到项目目录内然后执行检测啦：&lt;/p&gt;

&lt;p&gt;我们新建一个test.js进行检测&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;$ eslint test.js&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;javascript-style-guide&#34;&gt;JavaScript Style Guide&lt;/h2&gt;

&lt;p&gt;关于 JavaScript Style Guide 可以直接参考&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/airbnb/javascript&#34;&gt;https://github.com/airbnb/javascript&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;react-eslint&#34;&gt;react eslint&lt;/h2&gt;

&lt;p&gt;优先查看：&lt;/p&gt;

&lt;p&gt;在React+Babel+Webpack环境中使用ESLint&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.cnblogs.com/le0zh/p/5619350.html&#34;&gt;https://www.cnblogs.com/le0zh/p/5619350.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.bbsmax.com/A/obzbX0j65E/&#34;&gt;https://www.bbsmax.com/A/obzbX0j65E/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;React-native ESLint &amp;amp; Airbnb 配置&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/1d66a10466d2&#34;&gt;https://www.jianshu.com/p/1d66a10466d2&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;npm-run-lint-检查所有js文件&#34;&gt;npm run lint 检查所有js文件&lt;/h3&gt;

&lt;p&gt;在根目录的 package.json文件下修改如下:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;scripts&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;lint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;eslint --ext .js ./src --fix&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;根目录下运行:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;npm run lint&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id=&#34;再webpack配置中使用eslint加载器&#34;&gt;再webpack配置中使用eslint加载器&lt;/h3&gt;

&lt;p&gt;添加 到：webpack.cofnig.js&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;...
eslint: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
    configFile: &lt;span class=&#34;s1&#34;&gt;&amp;#39;./.eslintrc&amp;#39;&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;,
...&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id=&#34;pre-commit钩子&#34;&gt;pre-commit钩子&lt;/h3&gt;

&lt;p&gt;如果项目使用了git,可以通过使用pre-commit钩子在每次提交前检测，如果检测失败则禁止提交。可以在很大一定程度上保证代码质量。&lt;/p&gt;

&lt;p&gt;这里我们使用了pre-commitgit包来帮助我们实现这一目标。&lt;/p&gt;

&lt;p&gt;首先在package.json中添加script命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;scripts&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;{&lt;/span&gt;
    &lt;span class=&#34;nt&#34;&gt;&amp;#34;eslint&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;eslint --ext .js src&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;其次，安装pre-commit&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;npm install pre-commit --save-dev&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;最后，在package.json中配置pre-commit需要运行的命令：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-json&#34; data-lang=&#34;json&#34;&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;pre-commit&amp;#34;&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;:&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;
    &lt;span class=&#34;s2&#34;&gt;&amp;#34;eslint&amp;#34;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;完成之后，在每次提交之前，都会运行eslint命令进行检测，如果检测到有违反代码规则的情况，则会返回1，导致git commit失败。&lt;/p&gt;

&lt;h3 id=&#34;airbnb-eslint&#34;&gt;airbnb eslint&lt;/h3&gt;

&lt;p&gt;使用airbnb的eslint
&lt;a href=&#34;https://www.bbsmax.com/A/Ae5RYomYJQ/&#34;&gt;https://www.bbsmax.com/A/Ae5RYomYJQ/&lt;/a&gt;
&lt;a href=&#34;https://www.cnblogs.com/samwu/p/5772778.html&#34;&gt;https://www.cnblogs.com/samwu/p/5772778.html&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;ref&#34;&gt;Ref&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://segmentfault.com/a/1190000004965396&#34;&gt;https://segmentfault.com/a/1190000004965396&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/airbnb/javascript&#34;&gt;https://github.com/airbnb/javascript&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://spacemacs.org/layers/+frameworks/react/README.html&#34;&gt;http://spacemacs.org/layers/+frameworks/react/README.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://eslint.org/docs/user-guide/configuring&#34;&gt;https://eslint.org/docs/user-guide/configuring&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://csspod.com/getting-started-with-eslint/&#34;&gt;https://csspod.com/getting-started-with-eslint/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/ad6784d028aa&#34;&gt;https://www.jianshu.com/p/ad6784d028aa&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://eslint.cn/docs/user-guide/configuring&#34;&gt;http://eslint.cn/docs/user-guide/configuring&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>tools</title>
      <link>https://b.qqbb.app/post/tools/</link>
      <pubDate>Thu, 07 Feb 2019 00:00:00 +0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/tools/</guid>
      
        <description>

&lt;h2 id=&#34;what-are-the-best&#34;&gt;What are the best&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.slant.co&#34;&gt;https://www.slant.co&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;learn-to-code&#34;&gt;Learn to code&lt;/h2&gt;

&lt;h3 id=&#34;egghead&#34;&gt;egghead&lt;/h3&gt;

&lt;p&gt;通过一些短小视频，学习一系列实用技术&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://egghead.io/&#34;&gt;https://egghead.io/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&#34;github-issue&#34;&gt;github issue&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://issuehunt.io/&#34;&gt;https://issuehunt.io/&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;babel&#34;&gt;babel&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://babeljs.io/&#34;&gt;https://babeljs.io/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://babeljs.io/repl&#34;&gt;https://babeljs.io/repl&lt;/a&gt;&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>初始化安装 taro-msparis</title>
      <link>https://b.qqbb.app/post/taro-msparis-install/</link>
      <pubDate>Thu, 07 Feb 2019 00:00:00 +0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/taro-msparis-install/</guid>
      
        <description>

&lt;h2 id=&#34;appjson-tabbar-borderstyle-be-white-or-black&#34;&gt;appjson [&amp;ldquo;tabBar&amp;rdquo;][&amp;ldquo;borderStyle&amp;rdquo;] be &amp;ldquo;white&amp;rdquo; or &amp;ldquo;black&amp;rdquo;&lt;/h2&gt;

&lt;p&gt;dist/app.json中的 &amp;ldquo;tabBar&amp;rdquo;下的&amp;rdquo;borderStyle&amp;rdquo;要修改为： &amp;ldquo;black&amp;rdquo;&lt;/p&gt;

&lt;h2 id=&#34;微信小程序报错request-fail-url-not-in-domain-list&#34;&gt;微信小程序报错request:fail url not in domain list&lt;/h2&gt;

&lt;p&gt;报错提示说请求的url不在域名列表里，应该是还没有配置服务器域名，可点击开发者工具右上角 详情-域名信息，看看是否配置了域名；
不过没有配置域名其实开发者工具也是不能发送请求的；
文档：&lt;a href=&#34;https://developers.weixin.qq.com/miniprogram/dev/api/wx.request.html&#34;&gt;https://developers.weixin.qq.com/miniprogram/dev/api/wx.request.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;然后，操作如下：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;开发者工具里面要勾选不校验，也就是下面这句前打上勾：&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Does not verify valid domain names, web-view (business domain names), TLS versions and HTTPS certificates&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;手机里面也要打开调试，也就是：&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;开发版小程序不是右上角有三个点点嘛，点击就能看到打开调试&lt;/p&gt;

&lt;p&gt;这样就可以.&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>saleor 设置 templates base</title>
      <link>https://b.qqbb.app/post/saleor-conf-templates-base/</link>
      <pubDate>Fri, 01 Feb 2019 00:00:00 +0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/saleor-conf-templates-base/</guid>
      
        <description>

&lt;p&gt;安装完了 saleor ，下一步，自然就是修改一些我们自己的Logo，页脚之类的东西了。&lt;/p&gt;

&lt;h2 id=&#34;页脚copyright&#34;&gt;页脚COPYRIGHT&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ grep &lt;span class=&#34;s2&#34;&gt;&amp;#34;COPYRIGHT © 2009–2019 MIRUMEE SOFTWARE&amp;#34;&lt;/span&gt; -rn ./
./templates/base.html:296:        &amp;lt;div &lt;span class=&#34;nv&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;col-8 footer__copy-text&amp;#34;&lt;/span&gt;&amp;gt;COPYRIGHT © &lt;span class=&#34;m&#34;&gt;2009&lt;/span&gt;–2019 MIRUMEE SOFTWARE&amp;lt;/div&amp;gt;
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;把这里修改成我们自己的&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ vi templates/base.html
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ grep &lt;span class=&#34;s2&#34;&gt;&amp;#34;COPYRIGHT © 2009–2019 &amp;#34;&lt;/span&gt; -rn ./
../../../templates/base.html:296:        &amp;lt;div &lt;span class=&#34;nv&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;col-8 footer__copy-text&amp;#34;&lt;/span&gt;&amp;gt;COPYRIGHT © &lt;span class=&#34;m&#34;&gt;2009&lt;/span&gt;–2019 谦谦科技&amp;lt;/div&amp;gt;
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  images git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;页脚logo&#34;&gt;页脚Logo&lt;/h2&gt;

&lt;p&gt;只要审查元素就知道，这个 LOGO是 SVG图像。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-html&#34; data-lang=&#34;html&#34;&gt;&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;div&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;col-4&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;a&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;href&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{% url &amp;#39;home&amp;#39; %}&amp;#34;&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;footer__logo float-md-left&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;svg&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;data-src&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;{% static &amp;#34;&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;images&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;/&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;logo-document&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;na&#34;&gt;svg&lt;/span&gt;&lt;span class=&#34;err&#34;&gt;&amp;#34;&lt;/span&gt; &lt;span class=&#34;err&#34;&gt;%}&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&#34;p&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;a&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;div&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&#34;p&#34;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;div&lt;/span&gt; &lt;span class=&#34;na&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s&#34;&gt;&amp;#34;col-8 footer__copy-text&amp;#34;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;COPYRIGHT © 2009–2019 谦谦科技&lt;span class=&#34;p&#34;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&#34;nt&#34;&gt;div&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;&amp;gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;位置在&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ ls ./saleor/static/images/logo-document.svg
./saleor/static/images/logo-document.svg
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;所以，我们这里要制造我们自己的SVG图像。&lt;/p&gt;

&lt;p&gt;因为我对这个SVG不了解，就直接去&lt;a href=&#34;https://icomoon.io/app/#/select&#34;&gt;https://icomoon.io/app/#/select&lt;/a&gt;下载了个，并把它命名为 logo-test.svg。并放到指定的位置。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ mv ./logo-test.svg ./saleor/static/images/logo-test.svg
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ git diff templates/base.html
diff --git a/templates/base.html b/templates/base.html
index f9f67b1..9c5caf0 &lt;span class=&#34;m&#34;&gt;100644&lt;/span&gt;
--- a/templates/base.html
+++ b/templates/base.html
@@ -290,10 +290,10 @@
&amp;lt;div &lt;span class=&#34;nv&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;row&amp;#34;&lt;/span&gt;&amp;gt;
&amp;lt;div &lt;span class=&#34;nv&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;col-4&amp;#34;&lt;/span&gt;&amp;gt;
&amp;lt;a &lt;span class=&#34;nv&#34;&gt;href&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{% url &amp;#39;home&amp;#39; %}&amp;#34;&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;footer__logo float-md-left&amp;#34;&lt;/span&gt;&amp;gt;
-            &amp;lt;svg data-src&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{% static &amp;#34;&lt;/span&gt;images/logo-document.svg&lt;span class=&#34;s2&#34;&gt;&amp;#34; %}&amp;#34;&lt;/span&gt;/&amp;gt;
+            &amp;lt;svg data-src&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;{% static &amp;#34;&lt;/span&gt;images/logo-test.svg&lt;span class=&#34;s2&#34;&gt;&amp;#34; %}&amp;#34;&lt;/span&gt;/&amp;gt;
&amp;lt;/a&amp;gt;
&amp;lt;/div&amp;gt;
-        &amp;lt;div &lt;span class=&#34;nv&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;col-8 footer__copy-text&amp;#34;&lt;/span&gt;&amp;gt;COPYRIGHT © &lt;span class=&#34;m&#34;&gt;2009&lt;/span&gt;–2019 MIRUMEE SOFTWARE&amp;lt;/div&amp;gt;
+        &amp;lt;div &lt;span class=&#34;nv&#34;&gt;class&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;s2&#34;&gt;&amp;#34;col-8 footer__copy-text&amp;#34;&lt;/span&gt;&amp;gt;COPYRIGHT © &lt;span class=&#34;m&#34;&gt;2009&lt;/span&gt;–2019 千千科技&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&amp;lt;/div&amp;gt;
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;END&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;这样，就完成了页脚logo的替换。&lt;/p&gt;

&lt;h3 id=&#34;可跳过--svg-生成与展示&#34;&gt;(可跳过)SVG 生成与展示&lt;/h3&gt;

&lt;p&gt;参考 &lt;a href=&#34;https://www.jb51.net/article/105196.htm&#34;&gt;https://www.jb51.net/article/105196.htm&lt;/a&gt; 。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ sudo apt update &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; sudo apt-get install libxml2-dev libxslt1-dev python-dev python-lxml python-cairosvg  -y &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt; pip install pygal lxml cairosvg tinycss cssselect&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;页头-logo&#34;&gt;页头 logo&lt;/h2&gt;

&lt;p&gt;(saleor) ➜  saleor git:(master) ✗ grep &amp;ldquo;logo-document.svg&amp;rdquo; -rl ./templates/base.html | xargs sed -i &amp;ldquo;s/logo-document.svg/logo-document-qq.svg/g&amp;rdquo;
(saleor) ➜  saleor git:(master) ✗&lt;/p&gt;

&lt;p&gt;想了一下，干脆，所有的地方都替换一下。&lt;/p&gt;

&lt;p&gt;(saleor) ➜  saleor git:(master) ✗ grep logo-document.svg -rl ./saleor/core/emails.py | xargs sed -i &amp;ldquo;s/logo-document.svg/logo-document-qq.svg/g&amp;rdquo;
(saleor) ➜  saleor git:(master) ✗ grep logo-document.svg -rl ./templates/  | xargs sed -i &amp;ldquo;s/logo-document.svg/logo-document-qq.svg/g&amp;rdquo;
(saleor) ➜  saleor git:(master) ✗ grep logo-document.svg -rl ./saleor/static/dashboard-next/auth/components/LoginPage/LoginPage.tsx | xargs sed -i &amp;ldquo;s/logo-document.svg/logo-document-qq.svg/g&amp;rdquo;
(saleor) ➜  saleor git:(master) ✗&lt;/p&gt;

&lt;h2 id=&#34;dashboard-logo&#34;&gt;dashboard logo&lt;/h2&gt;

&lt;p&gt;(saleor) ➜  saleor git:(master) ✗ cp ./logo-document-qq.svg saleor/static/dashboard/images/logo-document-qq.svg
(saleor) ➜  saleor git:(master) ✗ grep &amp;ldquo;logo.svg&amp;rdquo; -rl ./templates/dashboard/base.html   | xargs sed -i &amp;ldquo;s/logo.svg/logo-document-qq.svg/g&amp;rdquo;
(saleor) ➜  saleor git:(master) ✗&lt;/p&gt;

&lt;h2 id=&#34;ref&#34;&gt;ref&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://icomoon.io/app/#/select&#34;&gt;https://icomoon.io/app/#/select&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>docker 安装 saleor</title>
      <link>https://b.qqbb.app/post/saleor-customization-docker/</link>
      <pubDate>Thu, 31 Jan 2019 00:00:00 +0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/saleor-customization-docker/</guid>
      
        <description>

&lt;p&gt;&lt;a href=&#34;https://docs.getsaleor.com/en/latest/customization/docker.html&#34;&gt;https://docs.getsaleor.com/en/latest/customization/docker.html&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;安装后&#34;&gt;安装后&lt;/h2&gt;

&lt;p&gt;完成步骤后的效果如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS                    NAMES
202bd2594ad9        saleor_web          &lt;span class=&#34;s2&#34;&gt;&amp;#34;python manage.py ru…&amp;#34;&lt;/span&gt;   About a minute ago   Up &lt;span class=&#34;m&#34;&gt;33&lt;/span&gt; seconds       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0:8000-&amp;gt;8000/tcp   saleor_web_1
af1d1c556b35        saleor_celery       &lt;span class=&#34;s2&#34;&gt;&amp;#34;celery -A saleor wo…&amp;#34;&lt;/span&gt;   About a minute ago   Up &lt;span class=&#34;m&#34;&gt;33&lt;/span&gt; seconds       &lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;/tcp                 saleor_celery_1
aa067abbd302        postgres:latest     &lt;span class=&#34;s2&#34;&gt;&amp;#34;docker-entrypoint.s…&amp;#34;&lt;/span&gt;   About a minute ago   Up &lt;span class=&#34;m&#34;&gt;34&lt;/span&gt; seconds       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0:5432-&amp;gt;5432/tcp   saleor_db_1
dfb447947378        redis:latest        &lt;span class=&#34;s2&#34;&gt;&amp;#34;docker-entrypoint.s…&amp;#34;&lt;/span&gt;   About a minute ago   Up &lt;span class=&#34;m&#34;&gt;33&lt;/span&gt; seconds       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0:6379-&amp;gt;6379/tcp   saleor_redis_1
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ docker images
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
saleor_celery       latest              ed5d34462667        &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; minutes ago       619MB
saleor_web          latest              ed5d34462667        &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; minutes ago       619MB
&amp;lt;none&amp;gt;              &amp;lt;none&amp;gt;              df1c689ebe30        About an hour ago   619MB
&amp;lt;none&amp;gt;              &amp;lt;none&amp;gt;              0bd648a8810c        About an hour ago   &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.42GB
&amp;lt;none&amp;gt;              &amp;lt;none&amp;gt;              f70f27cf8740        About an hour ago   &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.39GB
&amp;lt;none&amp;gt;              &amp;lt;none&amp;gt;              c0e63021a2e5        &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt; hours ago         965MB
node                &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt;                  c481a0ff9f4f        &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt; hours ago        897MB
postgres            latest              d03e2a8f3ed4        &lt;span class=&#34;m&#34;&gt;17&lt;/span&gt; hours ago        312MB
python              &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;.6-slim            e9b00f8a90d8        &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; days ago          138MB
python              &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;.6                 5b0503f864f4        &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt; days ago          922MB
redis               latest              82629e941a38        &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; days ago          95MB
hello-world         latest              fce289e99eb9        &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt; weeks ago         &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.84kB
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;error1&#34;&gt;error1&lt;/h2&gt;

&lt;p&gt;如果打开 &lt;a href=&#34;https://127.0.0.1:8000&#34;&gt;https://127.0.0.1:8000&lt;/a&gt; 出现了如下错误&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-text&#34; data-lang=&#34;text&#34;&gt;relation &amp;#34;django_site&amp;#34; does not exist LINE 1: ...&amp;#34;django_site&amp;#34;.&amp;#34;domain&amp;#34;, &amp;#34;django_site&amp;#34;.&amp;#34;name&amp;#34; FROM &amp;#34;django_si...&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;则说明是没有进行 `./manage.py migrate` 这一命令。也就是说，很可能，你忘记进行本
小节的第2步骤。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;docker-compose run web python3 manage.py migrate
docker-compose run web python3 manage.py collectstatic
docker-compose run web python3 manage.py populatedb --createsuperuser&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;当然，如果你确定，你是进行了上面的3个命令，还是有之前的那个报错，那么请进入
container，然后执行命令。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ docker ps
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
202bd2594ad9        saleor_web          &lt;span class=&#34;s2&#34;&gt;&amp;#34;python manage.py ru…&amp;#34;&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;30&lt;/span&gt; minutes ago      Up &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt; minutes       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0:8000-&amp;gt;8000/tcp   saleor_web_1
af1d1c556b35        saleor_celery       &lt;span class=&#34;s2&#34;&gt;&amp;#34;celery -A saleor wo…&amp;#34;&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;30&lt;/span&gt; minutes ago      Up &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt; minutes       &lt;span class=&#34;m&#34;&gt;8000&lt;/span&gt;/tcp                 saleor_celery_1
aa067abbd302        postgres:latest     &lt;span class=&#34;s2&#34;&gt;&amp;#34;docker-entrypoint.s…&amp;#34;&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;30&lt;/span&gt; minutes ago      Up &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt; minutes       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0:5432-&amp;gt;5432/tcp   saleor_db_1
dfb447947378        redis:latest        &lt;span class=&#34;s2&#34;&gt;&amp;#34;docker-entrypoint.s…&amp;#34;&lt;/span&gt;   &lt;span class=&#34;m&#34;&gt;30&lt;/span&gt; minutes ago      Up &lt;span class=&#34;m&#34;&gt;29&lt;/span&gt; minutes       &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.0.0:6379-&amp;gt;6379/tcp   saleor_redis_1
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ docker &lt;span class=&#34;nb&#34;&gt;exec&lt;/span&gt; -it 202bd2594ad9 bash
root@202bd2594ad9:/app# ./manage.py migrate
root@202bd2594ad9:/app# ./manage.py collectstatic
root@202bd2594ad9:/app# ./manage.py populatedb --createsuperuser&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;执行完成后，回到浏览器中去登陆 &lt;a href=&#34;http://192.168.1.103:8000/zh-hans/account/login/&#34;&gt;http://192.168.1.103:8000/zh-hans/account/login/&lt;/a&gt; ，应该是没有问题的。&lt;/p&gt;

&lt;p&gt;admin account : admin@example.com
password : admin&lt;/p&gt;

&lt;h2 id=&#34;ref&#34;&gt;Ref&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://stackoverflow.com/questions/23925726/django-relation-django-site-does-not-exist&#34;&gt;https://stackoverflow.com/questions/23925726/django-relation-django-site-does-not-exist&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>pipenv install 报错</title>
      <link>https://b.qqbb.app/post/pipenv-install-failed/</link>
      <pubDate>Thu, 31 Jan 2019 00:00:00 +0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/pipenv-install-failed/</guid>
      
        <description>&lt;p&gt;在某个项目中遇到了出错，如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; pipenv install --dev
Courtesy Notice: Pipenv found itself running within a virtual environment, so it will automatically use that environment, instead of creating its own &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; any project. You can &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PIPENV_IGNORE_VIRTUALENVS&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; to force pipenv to ignore that environment and create its own instead. You can &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PIPENV_VERBOSITY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;-1 to suppress this warning.
Installing dependencies from Pipfile.lock &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0c0b26&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;…
An error occurred &lt;span class=&#34;k&#34;&gt;while&lt;/span&gt; installing &lt;span class=&#34;nv&#34;&gt;yarl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.3.0 &lt;span class=&#34;p&#34;&gt;;&lt;/span&gt; python_version &amp;gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;3.4&amp;#39;&lt;/span&gt; --hash&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sha256:024ecdc12bc02b321bc66b41327f930d1c2c543fa9a561b39861da9388ba7aa9 --hash&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sha256:2f3010703295fbe1aec51023740871e64bb966
4c789cba5a6bdf404e93f7568f --hash&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sha256:3890ab952d508523ef4881457c4099056546593fa05e93da84c7250516e632eb --hash&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sha256:3e2724eb9af5dc41648e5bb304fcf4891adc33258c6e14e2a7414ea32541e320 --hash&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sha256:5badb
97dd0abf26623a9982cd448ff12cb39b8e4c94032ccdedf22ce01a64842 --hash&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sha256:73f447d11b530d860ca1e6b582f947688286ad16ca42256413083d13f260b7a0 --hash&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sha256:7ab825726f2940c16d92aaec7d204cfc34ac26c0040da727cf8
ba87255a33829 --hash&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sha256:b25de84a8c20540531526dfbb0e2d2b648c13fd5dd126728c496d7c3fea33310 --hash&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sha256:c6e341f5a6562af74ba55205dbd56d248daf1b5748ec48a0200ba227bb9e33f4 --hash&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sha256:c9bb7c249c4432cd47
e75af3864bc02d26c9594f49c82e2a28624417f0ae63b8 --hash&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;sha256:e060906c0c585565c718d1c3841747b61c5439af2211e185f6739a9412dfbde1! Will try again.
  🐍   ▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉ &lt;span class=&#34;m&#34;&gt;151&lt;/span&gt;/151 — &lt;span class=&#34;m&#34;&gt;00&lt;/span&gt;:02:25                                                                                                                                                  Installing initially failed dependencies…                                                                                                                                                                   &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:   File &lt;span class=&#34;s2&#34;&gt;&amp;#34;/home/tom/.virtualenvs/saleor/lib/python3.5/site-packages/pipenv/core.py&amp;#34;&lt;/span&gt;, line &lt;span class=&#34;m&#34;&gt;1874&lt;/span&gt;, in do_install
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:       &lt;span class=&#34;nv&#34;&gt;keep_outdated&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;keep_outdated
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:   File &lt;span class=&#34;s2&#34;&gt;&amp;#34;/home/tom/.virtualenvs/saleor/lib/python3.5/site-packages/pipenv/core.py&amp;#34;&lt;/span&gt;, line &lt;span class=&#34;m&#34;&gt;1253&lt;/span&gt;, in do_init
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:       &lt;span class=&#34;nv&#34;&gt;pypi_mirror&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;pypi_mirror,
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:   File &lt;span class=&#34;s2&#34;&gt;&amp;#34;/home/tom/.virtualenvs/saleor/lib/python3.5/site-packages/pipenv/core.py&amp;#34;&lt;/span&gt;, line &lt;span class=&#34;m&#34;&gt;859&lt;/span&gt;, in do_install_dependencies
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:       retry_list, procs, failed_deps_queue, requirements_dir, **install_kwargs
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:   File &lt;span class=&#34;s2&#34;&gt;&amp;#34;/home/tom/.virtualenvs/saleor/lib/python3.5/site-packages/pipenv/core.py&amp;#34;&lt;/span&gt;, line &lt;span class=&#34;m&#34;&gt;763&lt;/span&gt;, in batch_install
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:       _cleanup_procs&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;procs, not blocking, failed_deps_queue, &lt;span class=&#34;nv&#34;&gt;retry&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;retry&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:   File &lt;span class=&#34;s2&#34;&gt;&amp;#34;/home/tom/.virtualenvs/saleor/lib/python3.5/site-packages/pipenv/core.py&amp;#34;&lt;/span&gt;, line &lt;span class=&#34;m&#34;&gt;681&lt;/span&gt;, in _cleanup_procs
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;:       raise exceptions.InstallError&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;c.dep.name, &lt;span class=&#34;nv&#34;&gt;extra&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;err_lines&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Looking in indexes: https://pypi.python.org/simple&amp;#39;&lt;/span&gt;, &lt;span class=&#34;s1&#34;&gt;&amp;#39;Collecting yarl==1.3.0 (from -r /tmp/pipenv-umy9db73-requirements/pipenv-5nm2wwj2-requirement.txt (line 1))&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;pipenv.exceptions.InstallError&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;Could not find a version that satisfies the requirement yarl==1.3.0 (from -r /tmp/pipenv-umy9db73-requirements/pipenv-5nm2wwj2-requirement.txt (line 1)) (from versions:
&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt; 0.0.1, 0.1.0, 0.1.1, 0.1.2, 0.1.3, 0.1.4, 0.2.0, 0.2.1, 0.3.0, 0.3.1, 0.3.2, 0.4.0, 0.4.1, 0.4.2, 0.4.3, 0.5.0b2, 0.5.0b3, 0.5.0b4, 0.5.0b5, 0.5.0, 0.5.1, 0.5.2, 0.5.3, 0.6.0, 0.7.0, 0.7.1, 0.8.0, 0.8.1, 0.9.0, 0.9.1, 0.9.2, 0.9.3, 0.9.4, 0.9.5, 0.9.6, 0.9.7, 0.9.8, 0.10.0, 0.10.1, 0.10.2, 0.10.3, 0.11.0, 0.12.0, 0.13.0, 0.14.0, 0.14.1, 0.14.2, 0.15.0, 0.16.0, 0.17.0, 0.18.0, 1.0.0, 1.1.0, 1.1.1, 1.2.0)&amp;#39;&lt;/span&gt;
, &lt;span class=&#34;s1&#34;&gt;&amp;#39;No matching distribution found for yarl==1.3.0 (from -r /tmp/pipenv-umy9db73-requirements/pipenv-5nm2wwj2-requirement.txt (line 1))&amp;#39;&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
ERROR: ERROR: Package installation failed...
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;其实在最开始的时候，就已经提示`An error occurred while installing yarl==1.3.0`, 这个时候，如果我们看到了，应该要停止安装接下来的包，因为，最后还是会报错的。&lt;/p&gt;

&lt;p&gt;一个简单有效的思路，就是手工安装一下 yarl 包，看是不是版本不对。&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; grep yarl -rn ./Pipfile*
./Pipfile.lock:1384:        &lt;span class=&#34;s2&#34;&gt;&amp;#34;yarl&amp;#34;&lt;/span&gt;: &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; vi ./Pipfile.lock
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; pip install &lt;span class=&#34;nv&#34;&gt;yarl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.3
Collecting &lt;span class=&#34;nv&#34;&gt;yarl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.3
  Could not find a version that satisfies the requirement &lt;span class=&#34;nv&#34;&gt;yarl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.3 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;from versions: &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.0.1, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.1.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.1.1, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.1.2, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.1.3, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.1.4, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.2.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.2.1, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.3.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.3.1, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.3.2, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.4.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.4.1, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.4.2, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.4.3, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.5.0b2, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.5.0b3, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.5.0b4, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.5.0b5, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.5.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.5.1, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.5.2, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.5.3, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.6.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.7.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.7.1, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.8.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.8.1, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.9.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.9.1, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.9.2, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.9.3, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.9.4, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.9.5, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.9.6, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.9.7, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.9.8, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.10.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.10.1, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.10.2, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.10.3, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.11.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.12.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.13.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.14.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.14.1, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.14.2, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.15.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.16.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.17.0, &lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.18.0, &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.0.0, &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.1.0, &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.1.1, &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.2.0&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
No matching distribution found &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;yarl&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.3
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; pip install yarl
Collecting yarl
  Downloading https://files.pythonhosted.org/packages/23/7d/41beef3b35c1836079fde8408aebfb3c0a24c6bf2e66078d351fc4cfa1ff/yarl-1.2.0-cp35-cp35m-manylinux1_x86_64.whl &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;252kB&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;% &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;████████████████████████████████&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 256kB 520kB/s
Requirement already satisfied: idna&amp;gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;.0 in /home/tom/.virtualenvs/saleor/lib/python3.5/site-packages &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;from yarl&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;.8&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Requirement already satisfied: multidict&amp;gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;.0 in /home/tom/.virtualenvs/saleor/lib/python3.5/site-packages &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;from yarl&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;.5.2&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
Installing collected packages: yarl
Successfully installed yarl-1.2.0
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; vi ./Pipfile.lock
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ pipenv install --dev
Courtesy Notice: Pipenv found itself running within a virtual environment, so it will automatically use that environment, instead of creating its own &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; any project. You can &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PIPENV_IGNORE_VIRTUALENVS&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; to force pipenv to ignore that environment and create its own instead. You can &lt;span class=&#34;nb&#34;&gt;set&lt;/span&gt; &lt;span class=&#34;nv&#34;&gt;PIPENV_VERBOSITY&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;-1 to suppress this warning.
Installing dependencies from Pipfile.lock &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;0c0b26&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;…
  🐍   ▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉▉ &lt;span class=&#34;m&#34;&gt;151&lt;/span&gt;/151 — &lt;span class=&#34;m&#34;&gt;00&lt;/span&gt;:02:00
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ ls
apollo.config.js  common.env                   docker-compose.yml  LICENSE    package.json       Pipfile.lock  requirements_dev.txt  saleor     templates  tsconfig.json      webpack.d.ts
app.json          deployment                   Dockerfile          locale     package-lock.json  Procfile      requirements.txt      scripts    tests      tslint.json
CHANGELOG.md      docker-compose.override.yml  docs                manage.py  Pipfile            README.md     runtime.txt           setup.cfg  tox.ini    webpack.config.js
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;saleor&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  saleor git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;看到了吧。pip 直接安装的是 1.2.0 ,所以，把 Pipfile.lock 文件里的版本值 修改成 1.2.0 就可以了。&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>mac 上安装 sshpass</title>
      <link>https://b.qqbb.app/post/how-to-install-sshpass-on-mac/</link>
      <pubDate>Wed, 30 Jan 2019 00:00:00 +0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/how-to-install-sshpass-on-mac/</guid>
      
        <description>

&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;brew install https://raw.githubusercontent.com/kadwanev/bigboybrew/master/Library/Formula/sshpass.rb&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;ref&#34;&gt;Ref&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://stackoverflow.com/questions/32255660/how-to-install-sshpass-on-mac&#34;&gt;https://stackoverflow.com/questions/32255660/how-to-install-sshpass-on-mac&lt;/a&gt; fs&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>git中submodule子模块的添加、使用和删除</title>
      <link>https://b.qqbb.app/post/git-submodules-add-usage-delete/</link>
      <pubDate>Mon, 28 Jan 2019 00:00:00 -0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/git-submodules-add-usage-delete/</guid>
      
        <description>

&lt;h2 id=&#34;背景&#34;&gt;背景&lt;/h2&gt;

&lt;p&gt;项目中经常使用别人维护的模块，在git中使用子模块的功能能够大大提高开发效率。&lt;/p&gt;

&lt;p&gt;使用子模块后，不必负责子模块的维护，只需要在必要的时候同步更新子模块即可。&lt;/p&gt;

&lt;p&gt;本文主要讲解子模块相关的基础命令，详细使用请参考man page。&lt;/p&gt;

&lt;h2 id=&#34;子模块的添加&#34;&gt;子模块的添加&lt;/h2&gt;

&lt;p&gt;添加子模块非常简单，命令如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;git submodule add &amp;lt;url&amp;gt; &amp;lt;path&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;其中，url为子模块的路径，path为该子模块存储的目录路径。&lt;/p&gt;

&lt;p&gt;执行成功后，git status会看到项目中修改了.gitmodules，并增加了一个新文件（为刚刚添加的路径）&lt;/p&gt;

&lt;p&gt;git diff &amp;ndash;cached查看修改内容可以看到增加了子模块，并且新文件下为子模块的提交hash摘要&lt;/p&gt;

&lt;p&gt;git commit提交即完成子模块的添加&lt;/p&gt;

&lt;h2 id=&#34;子模块的使用&#34;&gt;子模块的使用&lt;/h2&gt;

&lt;p&gt;克隆项目后，默认子模块目录下无任何内容。需要在项目根目录执行如下命令完成子模块的下载：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;git submodule init
git submodule update&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;或：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;git submodule update --init --recursive&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;执行后，子模块目录下就有了源码，再执行相应的makefile即可。&lt;/p&gt;

&lt;h2 id=&#34;子模块的更新&#34;&gt;子模块的更新&lt;/h2&gt;

&lt;p&gt;子模块的维护者提交了更新后，使用子模块的项目必须手动更新才能包含最新的提交。&lt;/p&gt;

&lt;p&gt;在项目中，进入到子模块目录下，执行 git pull更新，查看git log查看相应提交。&lt;/p&gt;

&lt;p&gt;完成后返回到项目目录，可以看到子模块有待提交的更新，使用git add，提交即可。&lt;/p&gt;

&lt;h2 id=&#34;修改submodule-url&#34;&gt;修改Submodule URL&lt;/h2&gt;

&lt;p&gt;修改某模块URL&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;修改&amp;rsquo;.gitmodules&amp;rsquo;文件中对应模块的url属性;&lt;/li&gt;
&lt;li&gt;使用`git submodule sync`命令，将新的URL更新到文件.git/config；&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;thinker-g@localhost: ~/app$ git submodule sync
Synchronizing submodule url &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;s1&#34;&gt;&amp;#39;gitmods/thinker_g/Helpers&amp;#39;&lt;/span&gt;
thinker-g@localhost: ~/app$ &lt;span class=&#34;c1&#34;&gt;# 运行后可观察到&amp;#39;.git/config&amp;#39;中对应模块的url属性被更新
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;thinker-g@localhost: ~/app$ git commit -am &lt;span class=&#34;s2&#34;&gt;&amp;#34;Update submodule url.&amp;#34;&lt;/span&gt; # 提交变更&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;PS: 本实验使用git 2.7.4 完成，较低版本git可能不能自动更新.git/config文件，需要修修改完&amp;rdquo;.gitmodule&amp;rdquo;文件后手动修改.git/config.&lt;/p&gt;

&lt;h2 id=&#34;删除子模块&#34;&gt;删除子模块&lt;/h2&gt;

&lt;p&gt;有时子模块的项目维护地址发生了变化，或者需要替换子模块，就需要删除原有的子模块。&lt;/p&gt;

&lt;h3 id=&#34;优雅的删除子模块&#34;&gt;优雅的删除子模块&lt;/h3&gt;

&lt;p&gt;如何优雅的删除子模块(submodule)&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;c1&#34;&gt;# 逆初始化模块，其中{MOD_NAME}为模块目录，执行后可发现模块目录被清空
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;git submodule deinit &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;MOD_NAME&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# 删除.gitmodules中记录的模块信息（--cached选项清除.git/modules中的缓存）
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;git rm --cached &lt;span class=&#34;o&#34;&gt;{&lt;/span&gt;MOD_NAME&lt;span class=&#34;o&#34;&gt;}&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# 提交更改到代码库，可观察到&amp;#39;.gitmodules&amp;#39;内容发生变更
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;git commit -am &lt;span class=&#34;s2&#34;&gt;&amp;#34;Remove a submodule.&amp;#34;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Done! Nice &amp;amp; clean!&lt;/p&gt;

&lt;h3 id=&#34;不推荐-非优雅的删除子模块&#34;&gt;（不推荐）非优雅的删除子模块&lt;/h3&gt;

&lt;p&gt;删除子模块较复杂，步骤如下：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;rm -rf 子模块目录 删除子模块目录及源码&lt;/li&gt;
&lt;li&gt;vi .gitmodules 删除项目目录下.gitmodules文件中子模块相关条目&lt;/li&gt;
&lt;li&gt;vi .git/config 删除配置项中子模块相关条目&lt;/li&gt;
&lt;li&gt;rm .git/module/* 删除模块下的子模块目录，每个子模块对应一个目录，注意只删除对应的子模块目录即可&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;执行完成后，再执行添加子模块命令即可，如果仍然报错，执行如下：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;git rm --cached 子模块名称&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;完成删除后，提交到仓库即可。&lt;/p&gt;

&lt;h2 id=&#34;ref&#34;&gt;Ref&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/ed0cb6c75e25&#34;&gt;https://www.jianshu.com/p/ed0cb6c75e25&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://blog.csdn.net/guotianqing/article/details/82391665&#34;&gt;https://blog.csdn.net/guotianqing/article/details/82391665&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>tmux（笔记）</title>
      <link>https://b.qqbb.app/post/note-about-tmux/</link>
      <pubDate>Mon, 28 Jan 2019 00:00:00 -0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/note-about-tmux/</guid>
      
        <description>

&lt;h2 id=&#34;基础&#34;&gt;基础&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://blog.jobbole.com/87584/&#34;&gt;http://blog.jobbole.com/87584/&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&#34;高效的结对编程&#34;&gt;高效的结对编程&lt;/h3&gt;

&lt;p&gt;在Tmux 中使用 Tmate&lt;/p&gt;

&lt;h3 id=&#34;在文本间快速移动光标-复制文本&#34;&gt;在文本间快速移动光标，复制文本&lt;/h3&gt;

&lt;p&gt;将复制下来的文本发送到系统的剪贴板中&lt;/p&gt;

&lt;p&gt;Select and copy text&lt;/p&gt;

&lt;h3 id=&#34;调整-tmux-以增强其同-vim-的集成度&#34;&gt;调整 Tmux 以增强其同 Vim 的集成度&lt;/h3&gt;

&lt;p&gt;调整背景的配色方案&lt;/p&gt;

&lt;p&gt;调整光标的形状&lt;/p&gt;

&lt;p&gt;调整粘贴时的文本缩进&lt;/p&gt;

&lt;h3 id=&#34;美化-tmux-的状态栏&#34;&gt;美化 Tmux 的状态栏&lt;/h3&gt;

&lt;h2 id=&#34;tmux-plugins&#34;&gt;tmux-plugins&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/tmux-plugins&#34;&gt;https://github.com/tmux-plugins&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;查看version&#34;&gt;查看version&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;➜  ~ git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗ tmux -V
tmux &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;.1
➜  ~ git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ✗&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;滚屏&#34;&gt;滚屏&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://superuser.com/questions/209437/how-do-i-scroll-in-tmux&#34;&gt;https://superuser.com/questions/209437/how-do-i-scroll-in-tmux&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;复制文字&#34;&gt;复制文字&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://superuser.com/questions/196060/selecting-text-in-tmux-copy-mode&#34;&gt;https://superuser.com/questions/196060/selecting-text-in-tmux-copy-mode&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;ref&#34;&gt;Ref&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://zhuanlan.zhihu.com/p/33369297&#34;&gt;https://zhuanlan.zhihu.com/p/33369297&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/search?q=tmux&#34;&gt;https://github.com/search?q=tmux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/gpakosz/.tmux&#34;&gt;https://github.com/gpakosz/.tmux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://yq.aliyun.com/articles/44513&#34;&gt;https://yq.aliyun.com/articles/44513&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/ccac114c522e&#34;&gt;https://www.jianshu.com/p/ccac114c522e&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://superuser.com/questions/209437/how-do-i-scroll-in-tmux&#34;&gt;https://superuser.com/questions/209437/how-do-i-scroll-in-tmux&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://www.jianshu.com/p/ccac114c522e&#34;&gt;https://www.jianshu.com/p/ccac114c522e&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://os.51cto.com/art/201410/453671.htm&#34;&gt;http://os.51cto.com/art/201410/453671.htm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://os.51cto.com/art/201410/453671.htm&#34;&gt;http://os.51cto.com/art/201410/453671.htm&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
    <item>
      <title>用户加入docker组</title>
      <link>https://b.qqbb.app/post/add-user-to-docker-group/</link>
      <pubDate>Sun, 27 Jan 2019 00:00:00 -0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/add-user-to-docker-group/</guid>
      
        <description>

&lt;p&gt;Docker 创建docker用户组，应用用户加入docker组&lt;/p&gt;

&lt;h2 id=&#34;创建docker用户组&#34;&gt;创建docker用户组&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;sudo groupadd docker&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;应用用户加入docker用户组&#34;&gt;应用用户加入docker用户组&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;sudo usermod -aG docker &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;USER&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;重启docker服务&#34;&gt;重启docker服务&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;sudo systemctl restart docker&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;切换或者退出当前账户再从新登入&#34;&gt;切换或者退出当前账户再从新登入&lt;/h2&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;su root           &lt;span class=&#34;c1&#34;&gt;#  切换到root用户
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;su &lt;span class=&#34;si&#34;&gt;${&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;USER&lt;/span&gt;&lt;span class=&#34;si&#34;&gt;}&lt;/span&gt;        #  再切换到原来的应用用户以上配置才生效&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
      
    </item>
    
    <item>
      <title>django-oscar(笔记)</title>
      <link>https://b.qqbb.app/post/note-about-django-oscar/</link>
      <pubDate>Thu, 24 Jan 2019 00:00:00 -0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/note-about-django-oscar/</guid>
      
        <description>&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;39
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;40
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;41
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;42
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;43
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;44
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;oscar&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  django-oscar git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; make sandbox
pip install -r requirements.txt
Collecting &lt;span class=&#34;nv&#34;&gt;Werkzeug&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;0&lt;/span&gt;.14.1 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;from -r requirements.txt &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;line &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
  Downloading https://files.pythonhosted.org/packages/20/c4/12e3e56473e52375aa29c4764e70d1b8f3efa6682bef8d0aae04fe335243/Werkzeug-0.14.1-py2.py3-none-any.whl &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;322kB&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;% &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;████████████████████████████████&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 327kB &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt;.8MB/s
Collecting django-debug-toolbar&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;.11 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;from -r requirements.txt &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;line &lt;span class=&#34;m&#34;&gt;5&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
  Downloading https://files.pythonhosted.org/packages/01/9a/3db232bd15882d90d3c53de1f34ce0a522327849593c9198899713267cfe/django_debug_toolbar-1.11-py2.py3-none-any.whl &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;201kB&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;% &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;████████████████████████████████&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 204kB &lt;span class=&#34;m&#34;&gt;24&lt;/span&gt;.9MB/s
Collecting django-extensions&lt;span class=&#34;o&#34;&gt;==&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;.1.4 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;from -r requirements.txt &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;line &lt;span class=&#34;m&#34;&gt;6&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
  Downloading https://files.pythonhosted.org/packages/e4/56/6a854a56732f7cb6a0393b8a32ae8a37b82b004e638b7b2f153b66733ce5/django_extensions-2.1.4-py2.py3-none-any.whl &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;217kB&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;% &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;████████████████████████████████&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 225kB &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;.8MB/s
Collecting psycopg2&amp;lt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;.8,&amp;gt;&lt;span class=&#34;o&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;.7 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;from -r requirements.txt &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;line &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;))&lt;/span&gt;
  Downloading https://files.pythonhosted.org/packages/63/54/c039eb0f46f9a9406b59a638415c2012ad7be9b4b97bfddb1f48c280df3a/psycopg2-2.7.7.tar.gz &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;427kB&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
    &lt;span class=&#34;m&#34;&gt;100&lt;/span&gt;% &lt;span class=&#34;p&#34;&gt;|&lt;/span&gt;████████████████████████████████&lt;span class=&#34;p&#34;&gt;|&lt;/span&gt; 430kB &lt;span class=&#34;m&#34;&gt;4&lt;/span&gt;.1MB/s
    Complete output from &lt;span class=&#34;nb&#34;&gt;command&lt;/span&gt; python setup.py egg_info:
    running egg_info
    creating pip-egg-info/psycopg2.egg-info
    writing pip-egg-info/psycopg2.egg-info/PKG-INFO
    writing dependency_links to pip-egg-info/psycopg2.egg-info/dependency_links.txt
    writing top-level names to pip-egg-info/psycopg2.egg-info/top_level.txt
    writing manifest file &lt;span class=&#34;s1&#34;&gt;&amp;#39;pip-egg-info/psycopg2.egg-info/SOURCES.txt&amp;#39;&lt;/span&gt;

    Error: pg_config executable not found.

    pg_config is required to build psycopg2 from source.  Please add the directory
    containing pg_config to the &lt;span class=&#34;nv&#34;&gt;$PATH&lt;/span&gt; or specify the full executable path with the
    option:

        python setup.py build_ext --pg-config /path/to/pg_config build ...

    or with the pg_config option in &lt;span class=&#34;s1&#34;&gt;&amp;#39;setup.cfg&amp;#39;&lt;/span&gt;.

    If you prefer to avoid building psycopg2 from source, please install the PyPI
    &lt;span class=&#34;s1&#34;&gt;&amp;#39;psycopg2-binary&amp;#39;&lt;/span&gt; package instead.

    For further information please check the &lt;span class=&#34;s1&#34;&gt;&amp;#39;doc/src/install.rst&amp;#39;&lt;/span&gt; file &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;also at
    &amp;lt;http://initd.org/psycopg/docs/install.html&amp;gt;&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;.


    ----------------------------------------
Command &lt;span class=&#34;s2&#34;&gt;&amp;#34;python setup.py egg_info&amp;#34;&lt;/span&gt; failed with error code &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt; in /tmp/pip-install-e2o6_oa6/psycopg2/
Makefile:19: recipe &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; target &lt;span class=&#34;s1&#34;&gt;&amp;#39;install-python&amp;#39;&lt;/span&gt; failed
make: *** &lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;install-python&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt; Error &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;oscar&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt; ➜  django-oscar git:&lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;master&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;</description>
      
    </item>
    
    <item>
      <title>linux 关闭SSH 连接用户</title>
      <link>https://b.qqbb.app/post/linux-close-ssh-connection-user/</link>
      <pubDate>Tue, 22 Jan 2019 00:00:00 -0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/linux-close-ssh-connection-user/</guid>
      
        <description>&lt;p&gt;1.查明登陆端口；&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;$ who
root pts/1 Apr &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;00&lt;/span&gt;:06 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172&lt;/span&gt;.29.0.29&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;
root pts/2 Apr &lt;span class=&#34;m&#34;&gt;8&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;04&lt;/span&gt;:15 &lt;span class=&#34;o&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;m&#34;&gt;172&lt;/span&gt;.29.0.21&lt;span class=&#34;o&#34;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;2.通知该用户将要关闭他：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;$ &lt;span class=&#34;nb&#34;&gt;echo&lt;/span&gt; &lt;span class=&#34;s2&#34;&gt;&amp;#34;I will close your connection&amp;#34;&lt;/span&gt; &amp;gt; /dev/pts/2&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;这样他的终端将显示该信息。&lt;/p&gt;

&lt;p&gt;3.关闭用户连接&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;$ fuser -k /dev/pts/2&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;这个在某些命令，导致ssh后续无法操作时，我们就可以使用这个方式。&lt;/p&gt;


&lt;link rel=&#34;stylesheet&#34; href=&#34;https://b.qqbb.app/css/hugo-easy-gallery.css&#34; /&gt;
&lt;div class=&#34;box&#34;&gt;
&lt;figure  itemprop=&#34;associatedMedia&#34;
  itemscope itemtype=&#34;http://schema.org/ImageObject&#34; &gt;
    &lt;div class=&#34;img&#34;&gt;
      &lt;img itemprop=&#34;thumbnail&#34; src=&#34;https://res.cloudinary.com/dmtixvmgt/image/upload/v1548146143/linux-who-pts-fuser%5Fw5fvlm.png&#34; /&gt;
    &lt;/div&gt;
    &lt;a href=&#34;https://res.cloudinary.com/dmtixvmgt/image/upload/v1548146143/linux-who-pts-fuser%5Fw5fvlm.png&#34; itemprop=&#34;contentUrl&#34;&gt;&lt;/a&gt;
  &lt;/figure&gt;
&lt;/div&gt;


&lt;p&gt;疑问：当有多个ssh 连接时，那怎么知道我们要kill 的是哪个 pts 呢？&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>官方中文文档 openstack swift overview policies</title>
      <link>https://b.qqbb.app/post/jwl/swift-not-org/translation-openstack-swift-overview-policies/</link>
      <pubDate>Mon, 21 Jan 2019 00:00:00 -0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/jwl/swift-not-org/translation-openstack-swift-overview-policies/</guid>
      
        <description>

&lt;p&gt;&lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Fpolicies.html&#34;&gt;https://docs.openstack.org/swift/queens/overview%5Fpolicies.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;存储策略&lt;/p&gt;

&lt;p&gt;更新时间：2019-01-15 02:30&lt;/p&gt;

&lt;p&gt;存储策略允许通过创建多个对象环来为各种目的对集群进行某种程度的分段。存储策略功能在整个代码库中实现，因此它是理解Swift体系结构的重要概念。&lt;/p&gt;

&lt;p&gt;如The Rings中所述，Swift使用修改的散列环来确定数据应驻留在集群中的位置。帐户数据库，容器数据库，有一个单独的环; 每个存储策略也有一个对象环。(译者注：有3个ring)每个对象环的行为完全相同，并以相同的方式维护，但是对于策略，不同的设备可以属于不同的环。通过支持多个对象环，Swift允许应用程序和/或部署者基本上将对象存储隔离在单个集群中。有很多原因可能需要这样做：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;不同级别的持久性：如果提供商想要提供（例如，2x复制和3x复制，但不想维护2个单独的群集），则他们将设置2x和3x复制策略并将节点分配给各自的环。此外，如果提供商想要提供冷存储层，他们可以创建一个擦除编码策略。&lt;/li&gt;
&lt;li&gt;性能：正如SSD可以用作帐户或数据库环的独占成员一样，也可以创建仅限SSD的对象环，并用于实现低延迟/高性能策略。&lt;/li&gt;
&lt;li&gt;将节点收集到组中：不同的对象环可能具有不同的物理服务器，因此特定存储策略中的对象始终位于特定的数据中心或地理位置。&lt;/li&gt;
&lt;li&gt;不同的存储实现：另一个例子是收集使用不同Diskfile的一组节点（例如，Kinetic，GlusterFS）并使用策略将流量直接引导到那些节点。&lt;/li&gt;
&lt;li&gt;不同的读写关联设置：可以将代理服务器配置为对每个策略使用不同的读写关联选项。有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/deployment%5Fguide.html#proxy-server-per-policy-config&#34;&gt;每个策略配置&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;今天，Swift支持两种不同的策略类型：复制和擦除代码。有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Ferasure%5Fcode.html&#34;&gt;Erasure Code Support&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;另请注意，Diskfile是指后端对象存储插件架构。有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/development%5Fondisk%5Fbackends.html&#34;&gt;Pluggable On-Disk Back-end APIs&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&#34;容器和策略&#34;&gt;容器和策略&lt;/h2&gt;

&lt;p&gt;策略在容器级别实施。这种方式有许多优点，其中最重要的是它能够轻松地在想要利
用它们的应用程序上make life。它还确保存储策略仍然是Swift的核心功能，与auth实现无
关。帐户/身份验证层未实施策略，是因为它需要Swift部署人员更改正在使用的所有身份验
证系统。每个容器都有一个新的特殊的不可变元数据元素，称为存储策略索引(storage
policy index)。
请注意，在内部，Swift依赖于策略索引(policy indexes)而不是策略名称(policy name)。策略名称的存在是用于人类可读性，并且在代理中转换。创建容器时，支持一个新的可选header以指定策略名称。如果没有指定名称，使用默认策略（如果未定义其他策略，则将Policy-0视为默认策略）。我们将在下一节中介绍default和Policy-0之间的区别。&lt;/p&gt;

&lt;p&gt;创建容器时会分配策略。为容器分配策略后，将无法更改该策略（除非将其删除/重新
创建）。对大型数据集的数据放置/移动的影响将使这个任务最好留给应用程序执行。
因此，如果容器具有一个存在的策略（例如3x复制），并且想要将该数据迁移到
Erasure Code策略，则应用程序将创建另一个容器，指定策略其他参数，然后只需将
数据从一个容器移动到另一个。策略适用于每个容器，允许最小的应用程序感知
(minimal application awareness); 一旦使用特定策略创建了容器，则存储在其中的 所有对象将根据该策略完成。如果删除了具有特定名称的容器（要求容器变为空），则可以创建具有相同名称的新容器，而不受先前共享相同名称的已删除容器强制执行的存储策略的任何限制。&lt;/p&gt;

&lt;p&gt;容器与策略具有多对一关系，这意味着任意数量的容器都可以共享一个策略。可以使用特定策略的容器数量没有限制。&lt;/p&gt;

&lt;p&gt;将环与容器相关联的概念引入了一个有趣的场景：如果同时在网络中断的任一侧使用不同的存储策略创建了2个同名容器，会发生什么？此外，如果将对象放在这些容器中，一大堆容器中，然后网络中断被恢复，会发生什么？好吧，没有特别小心，这将是一个大问题，因为应用程序最终可能会使用错误的环来尝试找到一个对象。幸运的是，这个问题有一个解决方案，一个名为Container Reconciler的守护进程不知疲倦地工作以识别和纠正这种潜在的情况。&lt;/p&gt;

&lt;h2 id=&#34;容器协调器--container-reconciler&#34;&gt;容器协调器(Container Reconciler)&lt;/h2&gt;

&lt;p&gt;因为,无法,在分布式最终一致系统中,强制执行容器创建的原子性，所以对象写入错误
的存储策略必须最终由异步守护程序合并到正确的存储策略中。在网络分区期间从对象
写入恢复,导致了使用不同存储策略创建的脑裂容器, 由 swift-container-reconciler守护程序处理。&lt;/p&gt;

&lt;p&gt;容器协调程序使用类似于object-expirer的队列。在容器复制期间移动队列。将容器协调器评估的对象排入队列从未被认为是错误的，因为如果对象的位置没有任何问题，则协调器将简单地将其出列。容器协调队列是对象的实际位置的索引日志，对象的实际位置发现了容器的存储策略的差异。&lt;/p&gt;

&lt;p&gt;要确定容器的正确存储策略，当容器将状态从已删除更改为重新创建时，必须更新container_stat表中的status_changed_at字段。此事务日志允许容器复制器在复制容器和处理REPLICATE请求时更新正确的存储策略。&lt;/p&gt;

&lt;p&gt;由于每个对象写入都是一个单独的分布式事务，因此无法根据给定容器数据库中的整个事务日志确定每个对象写入的存储策略的正确性。因此，容器数据库将始终记录对象写入，而不管基于每个对象行的存储策略。每个容器中的每个存储策略都会跟踪对象字节和计数统计信息，并使用普通对象行合并语义进行协调。&lt;/p&gt;

&lt;p&gt;使用常规容器复制在复制期间确保对象行完全持久。在容器复制器将其对象行推送到可
用主节点之后，根据.misplaced_objects系统帐户下的对象时间戳，将任何放错位置的
对象行,批量加载到容器中。这些行,最初写入本地节点上的切换容器(handoff container)，并且在复制传递结束时，.misplaced_objects容器将复制到正确的主节点。&lt;/p&gt;

&lt;p&gt;容器协调程序按降序处理.misplaced_objects容器，并在成功协调行所表示的对象时,
重新收集容器。容器协调程序将始终,使用通过经缓存加速后的直接容器HEAD请求,验证排队对象的正确存储策略。&lt;/p&gt;

&lt;p&gt;由于假设，在合计下，各个存储节点的故障在大规模上是常见的，因此容器协调器,将
以简单的仲裁多数(a simple quorum majority),进行前进。在故障和rebalance的组合
期间，仲裁(a quorum)可能会提供正确存储策略的不完整记录 - 因此应用对象写入就
可能必须执行多次。由于存储节点和容器数据库,在重新应用对象写入时不会处理
X-Timestamp小于或等于其现有记录的写入，因此它们的时间戳会略微增加。为了将此
增量透明地应用于客户端，已将时间的第二个向量添加到Swift以供内部使用。见 &lt;a href=&#34;https://docs.openstack.org/swift/queens/misc.html#swift.common.utils.Timestamp&#34;&gt;Timestamp&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;由于协调程序将对象写入应用于正确的存储策略，因此它会清除不再适用于不正确的存储策略的写入，并从.misplaced_objects容器中删除行。成功处理完所有行后，它会休眠并定期检查容器复制期间要发现的新排队行。&lt;/p&gt;

&lt;h2 id=&#34;默认与-policy-0&#34;&gt;默认与&amp;rsquo;Policy- 0&amp;rsquo;&lt;/h2&gt;

&lt;p&gt;存储策略是一种通用功能，旨在支持具有相同级别灵活性的新群集和预先存在的群集。
出于这个原因，我们引入了Policy-0, 这个与“default”策略不同的概念。正如您将在我
们开始配置策略时所看到的，每个策略都有一个名称和任意数量的别名（人性化的，可
配置的）以及索引（或简单策略编号）。Swift保留索引0以映射到所有安装中存在的对象环（例如，/etc/swift/object.ring.gz）。您可以将此策略命名为您喜欢的任何名称，如果未定义任何策略，则会将其自身报告为Policy-0，但是您无法更改索引，因为必须始终存在索引为0的策略。&lt;/p&gt;

&lt;p&gt;另一个重要概念是默认策略，它可以是群集中的任何策略。默认策略是在未指定存储策
略的情况下发送容器创建请求时自动选择的策略。
&lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Fpolicies.html#configure-policy&#34;&gt;Configuring Policies&lt;/a&gt;介绍了如何设置默认策略。区别Policy-0是微妙的，但非常重要。 Policy-0是Swift在访问预存储策略容器没有策略时使用的 - 在这种情况下，我们不会使用默认值，因为它可能没有与旧容器相同的策略。如果未定义其他策略，Swift将始终选择Policy-0默认值。&lt;/p&gt;

&lt;p&gt;换句话说，默认策略意味着“如果没有指定其他内容则使用此策略创建”，并且Policy-0
策略意味着“如果没有容器策略则使用旧策略”,这实际上意味着使用object.ring.gz去查找。&lt;/p&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;使用基于存储策略的代码，无法创建没有策略的容器。如果没有提供任何内容，Swift
仍将选择默认策略并将其分配给容器。对于在引入存储策略之前创建的容器，将使用旧的Policy-0。&lt;/p&gt;

&lt;h2 id=&#34;弃用策略&#34;&gt;弃用策略&lt;/h2&gt;

&lt;p&gt;有时候不再需要一种策略; 但是，简单地删除策略和相关的环对于现有数据将是有问题的。为了确保资源不会在群集中孤立（留在磁盘上但不再可访问），并且在需要停用策略时向应用程序提供正确的消息传递，则使用弃用(deprecation)的概念。&lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Fpolicies.html#configure-policy&#34;&gt;Configuring Policies&lt;/a&gt;描述了如何弃用策略。&lt;/p&gt;

&lt;p&gt;Swift对弃用策略的行为如下：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;已弃用的策略不会出现在/info中&lt;/li&gt;
&lt;li&gt;在使用已弃用的策略创建的预先存在的容器上仍允许PUT/GET/DELETE/POST/HEAD&lt;/li&gt;
&lt;li&gt;尝试使用已弃用的策略创建新容器时，客户端将收到“400 Bad Request”错误&lt;/li&gt;
&lt;li&gt;客户端仍然可以通过HEAD访问预先存在的容器上的策略统计信息&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;策略不能同时是默认策略和弃用策略。如果您弃用默认策略，则必须指定新的默认策略。&lt;/p&gt;

&lt;p&gt;您还可以使用已弃用的功能部署新策略。如果想在使得新存储策略普遍可用之前测试新
存储策略，则可以在最初将新策略推送到所有节点时弃用该策略。被弃用将使其天生
(render it innate)并且无法使用。要测试它，您需要使用该存储策略创建容器; 这将
需要单个proxy实例（或一组仅在内部可访问的proxy-server），这些proxy实例已经被
一次性配置, 这个配置是带有新策略且未标记为已弃用。使用新存储策略创建容器后，
任何授权使用该容器的客户端都将能够在新存储策略中添加和访问存储在该容器中的数
据。如果满意，你可以推出一个新的swift.conf,它不再将策略标记为已弃用,到所有节点。&lt;/p&gt;

&lt;h2 id=&#34;配置策略&#34;&gt;配置策略&lt;/h2&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;有关向 SAIO设置添加策略的分步指南，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/policies%5Fsaio.html&#34;&gt;Adding Storage Policies to an Existing SAIO&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;部署者必须充分了解配置策略的语义。配置策略分为三个步骤：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;编辑/etc/swift/swift.conf文件以定义新策略。&lt;/li&gt;
&lt;li&gt;创建相应的策略对象环文件。&lt;/li&gt;
&lt;li&gt;（可选）创建特定于策略的proxy-server配置设置。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;定义策略&#34;&gt;定义策略&lt;/h3&gt;

&lt;p&gt;每个策略都由/etc/swift/swift.conf文件中的一个section定义。节名称必须是
[storage-policy:&lt;N&gt;]的格式, 所在&lt;N&gt;是策略索引。除了可读性之外，没有理由将策略索引按顺序排列，但强制执行以下规则：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;如果一个策略具有索引0,且索引0且未定义其他策略，则Swift将创建一个使用索引0的默认策略。&lt;/li&gt;
&lt;li&gt;策略索引必须是非负整数。&lt;/li&gt;
&lt;li&gt;策略索引必须是唯一的。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;警告&lt;/p&gt;

&lt;p&gt;创建和使用策略后，永远不应更改策略索引。更改策略索引可能会导致无法访问数据。&lt;/p&gt;

&lt;p&gt;每个策略section包含以下选项：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;name = &lt;policy\_name&gt; （必需）

&lt;ul&gt;
&lt;li&gt;策略的主要名称。&lt;/li&gt;
&lt;li&gt;策略名称不区分大小写。&lt;/li&gt;
&lt;li&gt;策略名称必须仅包含字母，数字或短划线。&lt;/li&gt;
&lt;li&gt;策略名称必须是唯一的。&lt;/li&gt;
&lt;li&gt;策略名称可以更改。&lt;/li&gt;
&lt;li&gt;名称Policy-0只能用于具有索引0的策略。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;aliases = &lt;policy\_name&gt;[, &lt;policy\_name&gt;, &amp;hellip;] （可选的）

&lt;ul&gt;
&lt;li&gt;以逗号分隔的策略备用名称列表。&lt;/li&gt;
&lt;li&gt;默认值是空列表（即没有别名）。&lt;/li&gt;
&lt;li&gt;所有别名必须遵循该name选项的规则。&lt;/li&gt;
&lt;li&gt;别名可以添加到列表中或从列表中删除。&lt;/li&gt;
&lt;li&gt;如果更改主名称，别名可用于保留对旧主名称的支持。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;default = [true|false] （可选的）

&lt;ul&gt;
&lt;li&gt;如果true在客户端未指定策略时将使用此策略。&lt;/li&gt;
&lt;li&gt;默认值为false。&lt;/li&gt;
&lt;li&gt;通过在所需的策略部分中进行设置，可以随时更改默认策略 。default = true&lt;/li&gt;
&lt;li&gt;如果没有将策略声明为缺省策略且未定义其他策略，则将具有索引的策略0设置为缺省策略;&lt;/li&gt;
&lt;li&gt;否则，必须将一个策略声明为default。&lt;/li&gt;
&lt;li&gt;不能将不推荐使用的策略声明为默认值。&lt;/li&gt;
&lt;li&gt;有关详细信息，请参阅默认与&amp;rsquo;Policy-0&amp;rsquo;。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;deprecated = [true|false] （可选的）

&lt;ul&gt;
&lt;li&gt;如果true此时无法使用此策略创建新容器。&lt;/li&gt;
&lt;li&gt;默认值为false。&lt;/li&gt;
&lt;li&gt;可以通过将deprecated选项添加到所需的策略部分来弃用任何策略。但是，不推荐使用已弃用的策略作为默认值。因此，由于必须始终存在默认策略，因此必须始终至少有一个未弃用的策略。&lt;/li&gt;
&lt;li&gt;有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Fpolicies.html#deprecate-policy&#34;&gt;Deprecating Policies&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;policy_type = [replication|erasure_coding] （可选的）

&lt;ul&gt;
&lt;li&gt;该选项policy_type用于区分不同的策略类型。&lt;/li&gt;
&lt;li&gt;默认值为replication。&lt;/li&gt;
&lt;li&gt;定义EC策略时使用该值erasure_coding。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;EC策略类型具有其他必需选项。有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Ferasure%5Fcode.html#using-ec-policy&#34;&gt;Using an Erasure Code Policy&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;以下是正确配置的swift.conf文件的示例。有关使用此示例配置而去设置一个all-in-one的完整说明，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/policies%5Fsaio.html&#34;&gt;Adding Storage Policies to an Existing SAIO&lt;/a&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;swift-hash&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# random unique strings that can never change (DO NOT LOSE)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Use only printable chars (python -c &amp;#34;import string; print(string.printable)&amp;#34;)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;swift_hash_path_prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; changeme
&lt;span class=&#34;nv&#34;&gt;swift_hash_path_suffix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; changeme

&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;storage-policy:0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; gold
&lt;span class=&#34;nv&#34;&gt;aliases&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; yellow, orange
&lt;span class=&#34;nv&#34;&gt;policy_type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; replication
&lt;span class=&#34;nv&#34;&gt;default&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; yes

&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;storage-policy:1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; silver
&lt;span class=&#34;nv&#34;&gt;policy_type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; replication
&lt;span class=&#34;nv&#34;&gt;deprecated&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; yes&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id=&#34;创建一个环&#34;&gt;创建一个环&lt;/h3&gt;

&lt;p&gt;一旦swift.conf配置为一个新的策略，必须创建一个新的环。环工具不支持策略名称，
因此在创建新策略的环文件时使用正确的策略索引至关重要。使用
swift-ring-builder创建其他对象环，与传统环是相同的方式,除了在构建文件名称的
单词object后面附加-N，其中N匹配在swift.conf中使用的策略索引。因此，如果是要为索引1策略创建环：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;swift-ring-builder object-1.builder create &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;在swift-ring-builder用于添加设备，rebalance等操作时，继续使用相同的命名约定。
此命名约定也用于pre-policy 存储节点数据字典的模式。&lt;/p&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;确实可以将相同的驱动器用于多个策略，并且将在后面的部分中介绍如何在磁盘上管理它的详细信息，在设置之前了解此类配置的含义非常重要。确保它真的是你想要做的，在许多情况下它会是，但在其他情况下可能不是。&lt;/p&gt;

&lt;h3 id=&#34;proxy-server-配置-可选&#34;&gt;Proxy server 配置（可选）&lt;/h3&gt;

&lt;p&gt;与读取和写入关联相关的 &lt;a href=&#34;https://docs.openstack.org/swift/queens/proxy.html#proxy-server&#34;&gt;Proxy Server&lt;/a&gt;配置选项，可以用单个存储策略来选择性覆盖。
有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/deployment%5Fguide.html#proxy-server-per-policy-config&#34;&gt;Per policy configuration&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&#34;使用策略&#34;&gt;使用策略&lt;/h2&gt;

&lt;p&gt;使用策略非常简单 - 仅在最初创建容器时指定策略。没有其他API可以更改。创建容器可以在没有任何特殊策略信息的情况下完成：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;curl -v -X PUT -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;X-Auth-Token: &amp;lt;your auth token&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;     http://127.0.0.1:8080/v1/AUTH_test/myCont0&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;假设我们使用上面的swift.conf示例，这将导致创建与策略名称“gold”关联的容器。它会使用&amp;rsquo;gold&amp;rsquo;，因为它被指定为默认值。现在，当我们将一个对象放入这个容器时，它将放置在我们创建的为策略&amp;rsquo;gold&amp;rsquo;环的一部分的节点上。&lt;/p&gt;

&lt;p&gt;如果我们想明确声明我们想要策略&amp;rsquo;gold&amp;rsquo;，那么命令只需要包含一个新的头，如下所示：&lt;/p&gt;

&lt;p&gt;卷曲 - v  - X  PUT  - ^ h  &amp;lsquo;X-验证令牌：&amp;lt;您的身份验证令牌&amp;gt;&amp;rsquo; \&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;^ h  &amp;lsquo;X-存储的策略：黄金&amp;rsquo;  HTTP ：// 127.0 。0.1 ：8080 / v1 / AUTH_test / myCont0&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;就是这样！应用程序不需要再次指定策略名称。然而，有一些非法行动：&lt;/p&gt;

&lt;p&gt;如果指定了无效（错字，不存在）策略：400 Bad Request
如果您尝试通过PUT或POST更改策略：409 Conflict
如果您想了解如何使用群集中的存储，只需将帐户抬起即可，您不仅可以看到累积数字，也可以看到以前的策略统计数据。在下面的示例中，共有3个对象，其中两个在策略&amp;rsquo;gold&amp;rsquo;中，另一个在策略&amp;rsquo;silver&amp;rsquo;中：&lt;/p&gt;

&lt;p&gt;卷曲 - 我 - X  HEAD  - ħ  &amp;lsquo;X-AUTH-令牌：&amp;lt;您的身份验证令牌&amp;gt;&amp;rsquo; &lt;br /&gt;
HTTP ：// 127.0 。0.1 ：8080 / v1 / AUTH_test
并且您的结果将包括（为了便于阅读，删除了一些输出）：&lt;/p&gt;

&lt;p&gt;X - 帐户- 容器- 数量： 3
X - 帐户- 对象- 数量： 3
X - 帐户- 字节- 使用： 21
X - 存储- 政策- 黄金- 对象- 数量： 2
X - 存储- 政策- 黄金- 字节- 使用： 14
X.- 存储- 策略- 银- 对象- 计数： 1
X - 存储- 策略- 银- 字节- 使用： 7
在引擎盖下¶
现在我们已经解释了一些关于策略是什么以及如何配置/使用它们，让我们来探讨存储策略如何适应螺母级别。&lt;/p&gt;

&lt;p&gt;解析和配置¶
模块Storage Policy负责解析 swift.conf文件，验证输入以及通过类创建已配置策略的全局集合StoragePolicyCollection。该集合由课程策略组成StoragePolicy。集合类包括通过名称或索引获取策略，获取有关策略等信息的便捷功能。还有一个非常重要的功能，get_object_ring()。对象环是StoragePolicy类的成员，实际上在load_ring() 调用方法之前不会实例化。代码库中任何需要访问对象环的调用者必须使用POLICIES全局单例来访问该 get_object_ring()函数并提供将调用的策略索引load_ring()如果需要的话; 但是，当启动请求处理服务（例如 代理服务器）时，会主动加载环以提供针对错误配置的中等保护，从而导致运行时错误。Swift启动时会实例化全局，并提供修补测试代码策略的机制。&lt;/p&gt;

&lt;p&gt;中间件¶
中间件可以通过POLICIES全局利用策略，并通过导入get_container_info()来访问与相关容器关联的策略索引。然后，它可以使用 POLICIES单例来获取正确的环。例如， List Endpoints使用刚刚描述的方法识别策略。另一个例子是Recon，它将报告所有环的md5总和。&lt;/p&gt;

&lt;p&gt;代理服务器¶
该代理服务器模块在存储策略，任务主要是确保正确的铃声作为其成员的元素。在策略之前，一个对象环将在实例化Application类时被实例化，并且可以通过init参数被测试代码覆盖。但是，对于策略，没有init参数，而Application 类依赖于POLICIES全局单例来检索在第一次需要时实例化的环。因此，代替Application该类的对象环成员，有一个访问器函数， get_object_ring()从中获取环 POLICIES。&lt;/p&gt;

&lt;p&gt;通常，当代理上运行的任何模块需要对象环时，它首先从缓存的容器信息中获取策略索引。例外是在容器创建期间，它使用请求标头中的策略名称从POLICIES全局查找策略索引。一旦代理确定了策略索引，它就可以使用get_object_ring()前面描述的 方法来访问正确的环。然后，它有责任通过标头将索引信息而不是策略名称传递给后端服务器。换句话说，代理还会从返回到客户端的标头中删除索引，并确保它们只能看到友好的策略名称。X -Backend-Storage-Policy-Index&lt;/p&gt;

&lt;p&gt;在磁盘存储上¶
每个策略在后端服务器上都有自己的目录，并由其存储策略索引标识。按策略索引组织后端目录结构有助于跟踪事物，并允许在策略之间共享磁盘，这可能是也可能没有意义，具体取决于提供者的需求。稍后会详细介绍，但现在请注意以下目录命名约定：&lt;/p&gt;

&lt;p&gt;/objects 映射到与Policy-0关联的对象
/objects-N 映射到存储策略索引#N
/async_pending 映射到Policy-0的异步挂起更新
/async_pending-N 映射到存储策略索引#N的异步挂起更新
/tmp 映射到Policy-0的DiskFile临时目录
/tmp-N 映射到策略索引#N的DiskFile临时目录
/quarantined/objects 映射到Policy-0的隔离目录
/quarantined/objects-N 映射到策略索引#N的隔离目录
请注意，这些目录名实际上由特定的Diskfile实现拥有，上面显示的名称由默认的Diskfile使用。&lt;/p&gt;

&lt;p&gt;对象服务器¶
该对象服务器不参与直接选择存储策略布局。但是，由于如何为策略设置后端目录结构，如前所述，对象服务器模块确实起作用。当对象服务器获取a时Diskfile，它会传入策略索引并保留实际的目录命名/结构机制 Diskfile。通过传入索引，Diskfile正在使用的实例 将确保数据根据其策略正确定位在树中。&lt;/p&gt;

&lt;p&gt;出于同样的原因，对象更新程序也具有策略意识。如前所述，不同的策略使用不同的异步挂起目录，因此更新程序需要知道如何正确扫描它们。&lt;/p&gt;

&lt;p&gt;该对象复制是政策意识到的是，根据该政策，可能需要做大幅度不同的东西，或者也许不是。例如，处理2x与3x的复制作业的差异是微不足道的; 但是，3x和擦除代码之间处理复制的差异绝对不是。实际上，术语“复制”实际上并不适合某些策略，如擦除代码; 但是，收集和处理工作的大多数框架都很常见。因此，复制器中的这些功能被用于所有策略，然后每个策略都需要特定于策略的代码，并在需要时定义策略时添加。&lt;/p&gt;

&lt;p&gt;由于同样的原因，ssync功能具有策略感知功能。某些其他模块可能不会受到明显影响，但所拥有的后端目录结构Diskfile需要策略索引参数。因此，ssync被政策意识真的意味着传递政策索引。见ssync_sender和 ssync_receiver关于SSYNC更多信息。&lt;/p&gt;

&lt;p&gt;就Diskfile其本身而言，政策意识就是使用提供的策略索引来管理后端结构。换句话说，获取Diskfile实例的调用者提供策略索引，并且其 Diskfile工作是通过此索引（但是它选择）保持数据分离，以便策略可以共享相同的媒体/节点（如果需要）。包含的实现Diskfile列出了前面描述的目录结构，但是它在内部Diskfile; 外部模块无法了解该细节。提供了一种通用功能，用于根据策略索引映射各种目录名称和/或字符串。例如， Diskfile定义get_data_dir()哪个构建一个泛型， get_policy_string()以便为各种用法一致地构建策略感知字符串。&lt;/p&gt;

&lt;p&gt;容器服务器¶
该容器服务器起着存储策略非常重要的作用，它负责处理到容器中，比如改变政策或选择了错误的政策规定没事的时候是使用预防坏事政策的分配（上记得前面的讨论策略0与默认值）。&lt;/p&gt;

&lt;p&gt;该集装箱更新是政策的注意，但是它的工作是非常简单的，沿到通过政策指数帐户服务器通过请求头。&lt;/p&gt;

&lt;p&gt;该集装箱后端同时负责修改现有的数据库架构，以及确保新的DB与支持存储策略的模式创建。容器模式的“按需”迁移允许Swift在没有停机的情况下进行升级（无论行数如何，sqlite的alter语句都很快）。为了支持滚动升级（和降级），对container_stat表的不兼容模式更改将对表进行 container_info，并且该container_stat表将替换为包含触发器的视图，该触发器使其行为类似于旧表。INSTEAD OF UPDATE&lt;/p&gt;

&lt;p&gt;策略索引存储在此处用于报告有关容器的信息以及管理容器及其存储策略之间的裂脑情景引起的差异。此外，在裂脑期间，必须准备容器以跟踪来自多个策略的对象更新，因此对象表还包括 storage_policy_index列。每个策略对象计数和字节在policy_stat表中使用INSERT和DELETE触发器更新，类似于container_stat直接更新的预策略触发器。&lt;/p&gt;

&lt;p&gt;当Container更新reconciler_sync_point表中的条目时，Container Replicator守护程序将主动迁移旧模式，作为其正常一致性检查过程的一部分 container_info。这确保了不会遇到任何写入的读取繁重容器仍将迁移到与存储后策略查询完全兼容，而不必回退并使用旧模式重试查询以服务容器读取请求。&lt;/p&gt;

&lt;p&gt;该集装箱同步功能，仅需要政策认识的，因为它访问对象戒指。因此，它需要从容器信息中提取策略索引，并使用它从POLICIES全局中选择适当的对象环。&lt;/p&gt;

&lt;p&gt;帐户服务器¶
该帐户服务器的在存储策略的作用实在有限申报。当对帐户发出HEAD请求时（请参阅前面提供的示例），将为帐户服务器提供存储策略索引，并基于每个策略为客户端构建object_count和byte_count信息。&lt;/p&gt;

&lt;p&gt;由于某些特定于策略的数据库架构更改，帐户服务器能够报告每个存储策略对象和字节数。特定policy_stat于策略的account_stat表以与策略相同的方式维护基于每个策略的信息（每个策略一行）。该 account_stat表仍然用于相同的目的而不会被替换 policy_stat，它保存总帐户统计数据，而policy_stat只是具有分解。后端还负责通过更改数据库架构来迁移预存储策略帐户，并在该时间点policy_stat使用当前account_stat数据填充Policy-0 的 表。&lt;/p&gt;

&lt;p&gt;每个存储策略对象和字节计数不会随每个对象PUT和DELETE请求一起更新，而是对帐户服务器的容器更新由异步执行swift-container-updater。&lt;/p&gt;

&lt;p&gt;升级和确认功能¶
升级到具有存储策略支持的Swift版本并不困难，事实上，集群管理员不需要进行任何特殊的配置更改即可开始。Swift将自动开始使用现有对象环作为默认环和Policy-0环。添加策略0的声明是完全可选的，在不存在时，给予隐式策略0的名称将是“Policy-0”。让我们说出于测试目的，您希望获取已经拥有大量数据的现有集群，并使用存储策略升级到Swift。从那里你想要继续创建一个策略并测试一些东西。你需要做的就是：&lt;/p&gt;

&lt;p&gt;将所有Swift节点升级到策略感知版本的Swift
在中定义您的政策 /etc/swift/swift.conf
创建相应的对象环
创建容器和对象，并按预期确认其放置位置
有关引导您完成这些步骤的特定示例，请参阅 将存储策略添加到现有SAIO&lt;/p&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;如果从已启用存储策略的Swift版本降级到不支持策略的旧版本，您将无法访问存储在索引为0的策略之外的任何数据，但这些对象将显示在容器列表中（如果有网络分区和未协调的对象，可能会重复）。在启用其他存储策略以确保为客户提供一致的API体验之前，对升级的部署执行任何必要的集成测试非常重要。一旦暴露多个存储策略，请勿降级到不支持存储策略的Swift版本。&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>官方中文文档 openstack swift overview policies</title>
      <link>https://b.qqbb.app/post/translation-openstack-swift-overview-policies/</link>
      <pubDate>Mon, 21 Jan 2019 00:00:00 -0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/translation-openstack-swift-overview-policies/</guid>
      
        <description>

&lt;p&gt;&lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Fpolicies.html&#34;&gt;https://docs.openstack.org/swift/queens/overview%5Fpolicies.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;存储策略&lt;/p&gt;

&lt;p&gt;更新时间：2019-01-15 02:30&lt;/p&gt;

&lt;p&gt;存储策略允许通过创建多个对象环来为各种目的对集群进行某种程度的分段。存储策略功能在整个代码库中实现，因此它是理解Swift体系结构的重要概念。&lt;/p&gt;

&lt;p&gt;如The Rings中所述，Swift使用修改的散列环来确定数据应驻留在集群中的位置。帐户数据库，容器数据库，有一个单独的环; 每个存储策略也有一个对象环。(译者注：有3个ring)每个对象环的行为完全相同，并以相同的方式维护，但是对于策略，不同的设备可以属于不同的环。通过支持多个对象环，Swift允许应用程序和/或部署者基本上将对象存储隔离在单个集群中。有很多原因可能需要这样做：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;不同级别的持久性：如果提供商想要提供（例如，2x复制和3x复制，但不想维护2个单独的群集），则他们将设置2x和3x复制策略并将节点分配给各自的环。此外，如果提供商想要提供冷存储层，他们可以创建一个擦除编码策略。&lt;/li&gt;
&lt;li&gt;性能：正如SSD可以用作帐户或数据库环的独占成员一样，也可以创建仅限SSD的对象环，并用于实现低延迟/高性能策略。&lt;/li&gt;
&lt;li&gt;将节点收集到组中：不同的对象环可能具有不同的物理服务器，因此特定存储策略中的对象始终位于特定的数据中心或地理位置。&lt;/li&gt;
&lt;li&gt;不同的存储实现：另一个例子是收集使用不同Diskfile的一组节点（例如，Kinetic，GlusterFS）并使用策略将流量直接引导到那些节点。&lt;/li&gt;
&lt;li&gt;不同的读写关联设置：可以将代理服务器配置为对每个策略使用不同的读写关联选项。有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/deployment%5Fguide.html#proxy-server-per-policy-config&#34;&gt;每个策略配置&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;今天，Swift支持两种不同的策略类型：复制和擦除代码。有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Ferasure%5Fcode.html&#34;&gt;Erasure Code Support&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;另请注意，Diskfile是指后端对象存储插件架构。有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/development%5Fondisk%5Fbackends.html&#34;&gt;Pluggable On-Disk Back-end APIs&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&#34;容器和策略&#34;&gt;容器和策略&lt;/h2&gt;

&lt;p&gt;策略在容器级别实施。这种方式有许多优点，其中最重要的是它能够轻松地在想要利
用它们的应用程序上make life。它还确保存储策略仍然是Swift的核心功能，与auth实现无
关。帐户/身份验证层未实施策略，是因为它需要Swift部署人员更改正在使用的所有身份验
证系统。每个容器都有一个新的特殊的不可变元数据元素，称为存储策略索引(storage
policy index)。
请注意，在内部，Swift依赖于策略索引(policy indexes)而不是策略名称(policy name)。策略名称的存在是用于人类可读性，并且在代理中转换。创建容器时，支持一个新的可选header以指定策略名称。如果没有指定名称，使用默认策略（如果未定义其他策略，则将Policy-0视为默认策略）。我们将在下一节中介绍default和Policy-0之间的区别。&lt;/p&gt;

&lt;p&gt;创建容器时会分配策略。为容器分配策略后，将无法更改该策略（除非将其删除/重新
创建）。对大型数据集的数据放置/移动的影响将使这个任务最好留给应用程序执行。
因此，如果容器具有一个存在的策略（例如3x复制），并且想要将该数据迁移到
Erasure Code策略，则应用程序将创建另一个容器，指定策略其他参数，然后只需将
数据从一个容器移动到另一个。策略适用于每个容器，允许最小的应用程序感知
(minimal application awareness); 一旦使用特定策略创建了容器，则存储在其中的 所有对象将根据该策略完成。如果删除了具有特定名称的容器（要求容器变为空），则可以创建具有相同名称的新容器，而不受先前共享相同名称的已删除容器强制执行的存储策略的任何限制。&lt;/p&gt;

&lt;p&gt;容器与策略具有多对一关系，这意味着任意数量的容器都可以共享一个策略。可以使用特定策略的容器数量没有限制。&lt;/p&gt;

&lt;p&gt;将环与容器相关联的概念引入了一个有趣的场景：如果同时在网络中断的任一侧使用不同的存储策略创建了2个同名容器，会发生什么？此外，如果将对象放在这些容器中，一大堆容器中，然后网络中断被恢复，会发生什么？好吧，没有特别小心，这将是一个大问题，因为应用程序最终可能会使用错误的环来尝试找到一个对象。幸运的是，这个问题有一个解决方案，一个名为Container Reconciler的守护进程不知疲倦地工作以识别和纠正这种潜在的情况。&lt;/p&gt;

&lt;h2 id=&#34;容器协调器--container-reconciler&#34;&gt;容器协调器(Container Reconciler)&lt;/h2&gt;

&lt;p&gt;因为,无法,在分布式最终一致系统中,强制执行容器创建的原子性，所以对象写入错误
的存储策略必须最终由异步守护程序合并到正确的存储策略中。在网络分区期间从对象
写入恢复,导致了使用不同存储策略创建的脑裂容器, 由 swift-container-reconciler守护程序处理。&lt;/p&gt;

&lt;p&gt;容器协调程序使用类似于object-expirer的队列。在容器复制期间移动队列。将容器协调器评估的对象排入队列从未被认为是错误的，因为如果对象的位置没有任何问题，则协调器将简单地将其出列。容器协调队列是对象的实际位置的索引日志，对象的实际位置发现了容器的存储策略的差异。&lt;/p&gt;

&lt;p&gt;要确定容器的正确存储策略，当容器将状态从已删除更改为重新创建时，必须更新container_stat表中的status_changed_at字段。此事务日志允许容器复制器在复制容器和处理REPLICATE请求时更新正确的存储策略。&lt;/p&gt;

&lt;p&gt;由于每个对象写入都是一个单独的分布式事务，因此无法根据给定容器数据库中的整个事务日志确定每个对象写入的存储策略的正确性。因此，容器数据库将始终记录对象写入，而不管基于每个对象行的存储策略。每个容器中的每个存储策略都会跟踪对象字节和计数统计信息，并使用普通对象行合并语义进行协调。&lt;/p&gt;

&lt;p&gt;使用常规容器复制在复制期间确保对象行完全持久。在容器复制器将其对象行推送到可
用主节点之后，根据.misplaced_objects系统帐户下的对象时间戳，将任何放错位置的
对象行,批量加载到容器中。这些行,最初写入本地节点上的切换容器(handoff container)，并且在复制传递结束时，.misplaced_objects容器将复制到正确的主节点。&lt;/p&gt;

&lt;p&gt;容器协调程序按降序处理.misplaced_objects容器，并在成功协调行所表示的对象时,
重新收集容器。容器协调程序将始终,使用通过经缓存加速后的直接容器HEAD请求,验证排队对象的正确存储策略。&lt;/p&gt;

&lt;p&gt;由于假设，在合计下，各个存储节点的故障在大规模上是常见的，因此容器协调器,将
以简单的仲裁多数(a simple quorum majority),进行前进。在故障和rebalance的组合
期间，仲裁(a quorum)可能会提供正确存储策略的不完整记录 - 因此应用对象写入就
可能必须执行多次。由于存储节点和容器数据库,在重新应用对象写入时不会处理
X-Timestamp小于或等于其现有记录的写入，因此它们的时间戳会略微增加。为了将此
增量透明地应用于客户端，已将时间的第二个向量添加到Swift以供内部使用。见 &lt;a href=&#34;https://docs.openstack.org/swift/queens/misc.html#swift.common.utils.Timestamp&#34;&gt;Timestamp&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;由于协调程序将对象写入应用于正确的存储策略，因此它会清除不再适用于不正确的存储策略的写入，并从.misplaced_objects容器中删除行。成功处理完所有行后，它会休眠并定期检查容器复制期间要发现的新排队行。&lt;/p&gt;

&lt;h2 id=&#34;默认与-policy-0&#34;&gt;默认与&amp;rsquo;Policy- 0&amp;rsquo;&lt;/h2&gt;

&lt;p&gt;存储策略是一种通用功能，旨在支持具有相同级别灵活性的新群集和预先存在的群集。
出于这个原因，我们引入了Policy-0, 这个与“default”策略不同的概念。正如您将在我
们开始配置策略时所看到的，每个策略都有一个名称和任意数量的别名（人性化的，可
配置的）以及索引（或简单策略编号）。Swift保留索引0以映射到所有安装中存在的对象环（例如，/etc/swift/object.ring.gz）。您可以将此策略命名为您喜欢的任何名称，如果未定义任何策略，则会将其自身报告为Policy-0，但是您无法更改索引，因为必须始终存在索引为0的策略。&lt;/p&gt;

&lt;p&gt;另一个重要概念是默认策略，它可以是群集中的任何策略。默认策略是在未指定存储策
略的情况下发送容器创建请求时自动选择的策略。
&lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Fpolicies.html#configure-policy&#34;&gt;Configuring Policies&lt;/a&gt;介绍了如何设置默认策略。区别Policy-0是微妙的，但非常重要。 Policy-0是Swift在访问预存储策略容器没有策略时使用的 - 在这种情况下，我们不会使用默认值，因为它可能没有与旧容器相同的策略。如果未定义其他策略，Swift将始终选择Policy-0默认值。&lt;/p&gt;

&lt;p&gt;换句话说，默认策略意味着“如果没有指定其他内容则使用此策略创建”，并且Policy-0
策略意味着“如果没有容器策略则使用旧策略”,这实际上意味着使用object.ring.gz去查找。&lt;/p&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;使用基于存储策略的代码，无法创建没有策略的容器。如果没有提供任何内容，Swift
仍将选择默认策略并将其分配给容器。对于在引入存储策略之前创建的容器，将使用旧的Policy-0。&lt;/p&gt;

&lt;h2 id=&#34;弃用策略&#34;&gt;弃用策略&lt;/h2&gt;

&lt;p&gt;有时候不再需要一种策略; 但是，简单地删除策略和相关的环对于现有数据将是有问题的。为了确保资源不会在群集中孤立（留在磁盘上但不再可访问），并且在需要停用策略时向应用程序提供正确的消息传递，则使用弃用(deprecation)的概念。&lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Fpolicies.html#configure-policy&#34;&gt;Configuring Policies&lt;/a&gt;描述了如何弃用策略。&lt;/p&gt;

&lt;p&gt;Swift对弃用策略的行为如下：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;已弃用的策略不会出现在/info中&lt;/li&gt;
&lt;li&gt;在使用已弃用的策略创建的预先存在的容器上仍允许PUT/GET/DELETE/POST/HEAD&lt;/li&gt;
&lt;li&gt;尝试使用已弃用的策略创建新容器时，客户端将收到“400 Bad Request”错误&lt;/li&gt;
&lt;li&gt;客户端仍然可以通过HEAD访问预先存在的容器上的策略统计信息&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;策略不能同时是默认策略和弃用策略。如果您弃用默认策略，则必须指定新的默认策略。&lt;/p&gt;

&lt;p&gt;您还可以使用已弃用的功能部署新策略。如果想在使得新存储策略普遍可用之前测试新
存储策略，则可以在最初将新策略推送到所有节点时弃用该策略。被弃用将使其天生
(render it innate)并且无法使用。要测试它，您需要使用该存储策略创建容器; 这将
需要单个proxy实例（或一组仅在内部可访问的proxy-server），这些proxy实例已经被
一次性配置, 这个配置是带有新策略且未标记为已弃用。使用新存储策略创建容器后，
任何授权使用该容器的客户端都将能够在新存储策略中添加和访问存储在该容器中的数
据。如果满意，你可以推出一个新的swift.conf,它不再将策略标记为已弃用,到所有节点。&lt;/p&gt;

&lt;h2 id=&#34;配置策略&#34;&gt;配置策略&lt;/h2&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;有关向 SAIO设置添加策略的分步指南，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/policies%5Fsaio.html&#34;&gt;Adding Storage Policies to an Existing SAIO&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;部署者必须充分了解配置策略的语义。配置策略分为三个步骤：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;编辑/etc/swift/swift.conf文件以定义新策略。&lt;/li&gt;
&lt;li&gt;创建相应的策略对象环文件。&lt;/li&gt;
&lt;li&gt;（可选）创建特定于策略的proxy-server配置设置。&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;定义策略&#34;&gt;定义策略&lt;/h3&gt;

&lt;p&gt;每个策略都由/etc/swift/swift.conf文件中的一个section定义。节名称必须是
[storage-policy:&lt;N&gt;]的格式, 所在&lt;N&gt;是策略索引。除了可读性之外，没有理由将策略索引按顺序排列，但强制执行以下规则：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;如果一个策略具有索引0,且索引0且未定义其他策略，则Swift将创建一个使用索引0的默认策略。&lt;/li&gt;
&lt;li&gt;策略索引必须是非负整数。&lt;/li&gt;
&lt;li&gt;策略索引必须是唯一的。&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;警告&lt;/p&gt;

&lt;p&gt;创建和使用策略后，永远不应更改策略索引。更改策略索引可能会导致无法访问数据。&lt;/p&gt;

&lt;p&gt;每个策略section包含以下选项：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;name = &lt;policy\_name&gt; （必需）

&lt;ul&gt;
&lt;li&gt;策略的主要名称。&lt;/li&gt;
&lt;li&gt;策略名称不区分大小写。&lt;/li&gt;
&lt;li&gt;策略名称必须仅包含字母，数字或短划线。&lt;/li&gt;
&lt;li&gt;策略名称必须是唯一的。&lt;/li&gt;
&lt;li&gt;策略名称可以更改。&lt;/li&gt;
&lt;li&gt;名称Policy-0只能用于具有索引0的策略。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;aliases = &lt;policy\_name&gt;[, &lt;policy\_name&gt;, &amp;hellip;] （可选的）

&lt;ul&gt;
&lt;li&gt;以逗号分隔的策略备用名称列表。&lt;/li&gt;
&lt;li&gt;默认值是空列表（即没有别名）。&lt;/li&gt;
&lt;li&gt;所有别名必须遵循该name选项的规则。&lt;/li&gt;
&lt;li&gt;别名可以添加到列表中或从列表中删除。&lt;/li&gt;
&lt;li&gt;如果更改主名称，别名可用于保留对旧主名称的支持。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;default = [true|false] （可选的）

&lt;ul&gt;
&lt;li&gt;如果true在客户端未指定策略时将使用此策略。&lt;/li&gt;
&lt;li&gt;默认值为false。&lt;/li&gt;
&lt;li&gt;通过在所需的策略部分中进行设置，可以随时更改默认策略 。default = true&lt;/li&gt;
&lt;li&gt;如果没有将策略声明为缺省策略且未定义其他策略，则将具有索引的策略0设置为缺省策略;&lt;/li&gt;
&lt;li&gt;否则，必须将一个策略声明为default。&lt;/li&gt;
&lt;li&gt;不能将不推荐使用的策略声明为默认值。&lt;/li&gt;
&lt;li&gt;有关详细信息，请参阅默认与&amp;rsquo;Policy-0&amp;rsquo;。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;deprecated = [true|false] （可选的）

&lt;ul&gt;
&lt;li&gt;如果true此时无法使用此策略创建新容器。&lt;/li&gt;
&lt;li&gt;默认值为false。&lt;/li&gt;
&lt;li&gt;可以通过将deprecated选项添加到所需的策略部分来弃用任何策略。但是，不推荐使用已弃用的策略作为默认值。因此，由于必须始终存在默认策略，因此必须始终至少有一个未弃用的策略。&lt;/li&gt;
&lt;li&gt;有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Fpolicies.html#deprecate-policy&#34;&gt;Deprecating Policies&lt;/a&gt;。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;policy_type = [replication|erasure_coding] （可选的）

&lt;ul&gt;
&lt;li&gt;该选项policy_type用于区分不同的策略类型。&lt;/li&gt;
&lt;li&gt;默认值为replication。&lt;/li&gt;
&lt;li&gt;定义EC策略时使用该值erasure_coding。&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;EC策略类型具有其他必需选项。有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Ferasure%5Fcode.html#using-ec-policy&#34;&gt;Using an Erasure Code Policy&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;以下是正确配置的swift.conf文件的示例。有关使用此示例配置而去设置一个all-in-one的完整说明，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/policies%5Fsaio.html&#34;&gt;Adding Storage Policies to an Existing SAIO&lt;/a&gt;：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;swift-hash&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;c1&#34;&gt;# random unique strings that can never change (DO NOT LOSE)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;# Use only printable chars (python -c &amp;#34;import string; print(string.printable)&amp;#34;)
&lt;/span&gt;&lt;span class=&#34;c1&#34;&gt;&lt;/span&gt;&lt;span class=&#34;nv&#34;&gt;swift_hash_path_prefix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; changeme
&lt;span class=&#34;nv&#34;&gt;swift_hash_path_suffix&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; changeme

&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;storage-policy:0&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; gold
&lt;span class=&#34;nv&#34;&gt;aliases&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; yellow, orange
&lt;span class=&#34;nv&#34;&gt;policy_type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; replication
&lt;span class=&#34;nv&#34;&gt;default&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; yes

&lt;span class=&#34;o&#34;&gt;[&lt;/span&gt;storage-policy:1&lt;span class=&#34;o&#34;&gt;]&lt;/span&gt;
&lt;span class=&#34;nv&#34;&gt;name&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; silver
&lt;span class=&#34;nv&#34;&gt;policy_type&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; replication
&lt;span class=&#34;nv&#34;&gt;deprecated&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; yes&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id=&#34;创建一个环&#34;&gt;创建一个环&lt;/h3&gt;

&lt;p&gt;一旦swift.conf配置为一个新的策略，必须创建一个新的环。环工具不支持策略名称，
因此在创建新策略的环文件时使用正确的策略索引至关重要。使用
swift-ring-builder创建其他对象环，与传统环是相同的方式,除了在构建文件名称的
单词object后面附加-N，其中N匹配在swift.conf中使用的策略索引。因此，如果是要为索引1策略创建环：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;swift-ring-builder object-1.builder create &lt;span class=&#34;m&#34;&gt;10&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt; &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;在swift-ring-builder用于添加设备，rebalance等操作时，继续使用相同的命名约定。
此命名约定也用于pre-policy 存储节点数据字典的模式。&lt;/p&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;确实可以将相同的驱动器用于多个策略，并且将在后面的部分中介绍如何在磁盘上管理它的详细信息，在设置之前了解此类配置的含义非常重要。确保它真的是你想要做的，在许多情况下它会是，但在其他情况下可能不是。&lt;/p&gt;

&lt;h3 id=&#34;proxy-server-配置-可选&#34;&gt;Proxy server 配置（可选）&lt;/h3&gt;

&lt;p&gt;与读取和写入关联相关的 &lt;a href=&#34;https://docs.openstack.org/swift/queens/proxy.html#proxy-server&#34;&gt;Proxy Server&lt;/a&gt;配置选项，可以用单个存储策略来选择性覆盖。
有关详细信息，请参阅 &lt;a href=&#34;https://docs.openstack.org/swift/queens/deployment%5Fguide.html#proxy-server-per-policy-config&#34;&gt;Per policy configuration&lt;/a&gt;。&lt;/p&gt;

&lt;h2 id=&#34;使用策略&#34;&gt;使用策略&lt;/h2&gt;

&lt;p&gt;使用策略非常简单 - 仅在最初创建容器时指定策略。没有其他API可以更改策略。创建容器可以在没有任何特殊策略信息的情况下完成：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;curl -v -X PUT -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;X-Auth-Token: &amp;lt;your auth token&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;     http://127.0.0.1:8080/v1/AUTH_test/myCont0&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;假设我们使用上面的swift.conf示例，这将导致创建与策略名称“gold”关联的容器。它会使用&amp;rsquo;gold&amp;rsquo;，因为它被指定为默认值。现在，当我们将一个对象放入这个容器时，它将放置在我们创建的为策略&amp;rsquo;gold&amp;rsquo;环的一部分的节点上。&lt;/p&gt;

&lt;p&gt;如果我们想明确声明我们想要策略&amp;rsquo;gold&amp;rsquo;，那么命令只需要包含一个新的头，如下所示：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;curl -v -X PUT -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;X-Auth-Token: &amp;lt;your auth token&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;     -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;X-Storage-Policy: gold&amp;#39;&lt;/span&gt; http://127.0.0.1:8080/v1/AUTH_test/myCont0&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;就是这样！应用程序不需要再次指定策略名称。然而，有一些非法操作：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;如果指定了无效（错字，不存在）策略：400 Bad Request&lt;/li&gt;
&lt;li&gt;如果您尝试通过PUT或POST更改策略：409 Conflict&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;如果您想了解如何使用群集中的存储，只需将HEAD the account即可，您不仅可以看到累积
数量，也可以像之前的一样，看到每个策略统计数据。在下面的示例中，共有3个对象，其中两个在策略&amp;rsquo;gold&amp;rsquo;中，另一个在策略&amp;rsquo;silver&amp;rsquo;中：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;curl -i -X HEAD -H &lt;span class=&#34;s1&#34;&gt;&amp;#39;X-Auth-Token: &amp;lt;your auth token&amp;gt;&amp;#39;&lt;/span&gt; &lt;span class=&#34;se&#34;&gt;\
&lt;/span&gt;&lt;span class=&#34;se&#34;&gt;&lt;/span&gt;     http://127.0.0.1:8080/v1/AUTH_test&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;并且您的结果将包括（为了便于阅读，删除了一些输出）：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;7
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;X-Account-Container-Count: &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
X-Account-Object-Count: &lt;span class=&#34;m&#34;&gt;3&lt;/span&gt;
X-Account-Bytes-Used: &lt;span class=&#34;m&#34;&gt;21&lt;/span&gt;
X-Storage-Policy-Gold-Object-Count: &lt;span class=&#34;m&#34;&gt;2&lt;/span&gt;
X-Storage-Policy-Gold-Bytes-Used: &lt;span class=&#34;m&#34;&gt;14&lt;/span&gt;
X-Storage-Policy-Silver-Object-Count: &lt;span class=&#34;m&#34;&gt;1&lt;/span&gt;
X-Storage-Policy-Silver-Bytes-Used: &lt;span class=&#34;m&#34;&gt;7&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h2 id=&#34;在引擎盖下&#34;&gt;在引擎盖下&lt;/h2&gt;

&lt;p&gt;现在我们已经解释了一些关于策略是什么以及如何配置/使用它们，让我们来探讨存储
策略如何适用于螺母级别（the nut-n-bolts level）。&lt;/p&gt;

&lt;h3 id=&#34;解析和配置&#34;&gt;解析和配置&lt;/h3&gt;

&lt;p&gt;模块&lt;a href=&#34;https://docs.openstack.org/swift/queens/misc.html#storage-policy&#34;&gt;Storage Policy&lt;/a&gt;负责解析 swift.conf文件，验证输入以及通过类
&lt;a href=&#34;https://docs.openstack.org/swift/queens/misc.html#swift.common.storage%5Fpolicy.StoragePolicyCollection&#34;&gt;StoragePolicyCollection&lt;/a&gt; 创建已配置策略的全局集合(a global collection)。该集
合由类&lt;a href=&#34;https://docs.openstack.org/swift/queens/misc.html#swift.common.storage%5Fpolicy.StoragePolicy&#34;&gt;StoragePolicy&lt;/a&gt;策略组成。集合类包括通过名称或索引获取策略，获取有关策略
等信息的便捷功能。还有一个非常重要的function，&lt;a href=&#34;https://docs.openstack.org/swift/queens/misc.html#swift.common.storage%5Fpolicy.StoragePolicyCollection.get%5Fobject%5Fring&#34;&gt;get_object_ring()&lt;/a&gt;。对象环是类
&lt;a href=&#34;https://docs.openstack.org/swift/queens/misc.html#swift.common.storage%5Fpolicy.StoragePolicy&#34;&gt;StoragePolicy&lt;/a&gt;的成员，实际上在load_ring() 方法被调用之前不会实例化。Any caller anywhere in the code base that needs to access an object ring must use the POLICIES global singleton to access the get_object_ring() function and provide the policy index which will call load_ring() if needed; however, when starting request handling services such as the Proxy Server rings are proactively loaded to provide moderate protection against a mis-configuration resulting in a run time error. Swift启动时会实例化全局，并提供修补测试代码的策略的机制。&lt;/p&gt;

&lt;h3 id=&#34;中间件&#34;&gt;中间件&lt;/h3&gt;

&lt;p&gt;中间件可以通过POLICIES全局变量利用策略，并通过导入&lt;a href=&#34;https://docs.openstack.org/swift/queens/proxy.html#swift.proxy.controllers.base.get%5Fcontainer%5Finfo&#34;&gt;get_container_info()&lt;/a&gt;来访问
与相关容器关联的策略索引。通过策略索引，它可以使用 POLICIES singleton来获取正确的环。例如，&lt;a href=&#34;https://docs.openstack.org/swift/queens/middleware.html#list-endpoints&#34;&gt;List Endpoints&lt;/a&gt;使用刚刚描述的方法识别策略。另一个例子是&lt;a href=&#34;https://docs.openstack.org/swift/queens/middleware.html#recon&#34;&gt;Recon&lt;/a&gt;，它将报告所有环的md5总和。&lt;/p&gt;

&lt;h3 id=&#34;proxy-server&#34;&gt;Proxy Server&lt;/h3&gt;

&lt;p&gt;该 &lt;a href=&#34;https://docs.openstack.org/swift/queens/proxy.html#proxy-server&#34;&gt;Proxy Server&lt;/a&gt;模块在存储策略的任务主要是确保正确的ring作为其成员的元素。在策
略之前，一个对象环将在实例化&lt;a href=&#34;https://docs.openstack.org/swift/queens/proxy.html#swift.proxy.server.Application&#34;&gt;Application&lt;/a&gt;类时被实例化，并且可以通过init参数被测
试代码覆盖。但是，对于策略，没有init参数，而&lt;a href=&#34;https://docs.openstack.org/swift/queens/proxy.html#swift.proxy.server.Application&#34;&gt;Application&lt;/a&gt;类依赖于POLICIES global
singleton 来检索,在第一次需要时实例化的,环。因此，替代&lt;a href=&#34;https://docs.openstack.org/swift/queens/proxy.html#swift.proxy.server.Application&#34;&gt;Application&lt;/a&gt;该类的对象环成员，有一个访问器函数，&lt;a href=&#34;https://docs.openstack.org/swift/queens/proxy.html#swift.proxy.server.Application.get%5Fobject%5Fring&#34;&gt;get_object_ring()&lt;/a&gt;从 POLICIES中获取环。&lt;/p&gt;

&lt;p&gt;通常，当代理上运行的任何模块需要对象环时，它首先从缓存的容器信息中获取策略索引。
例外是在容器创建期间，它使用请求头中的策略名称从POLICIES全局变量查找策略索引。
一旦代理确定了策略索引，它就可以使用前面描述的&lt;a href=&#34;https://docs.openstack.org/swift/queens/proxy.html#swift.proxy.server.Application.get%5Fobject%5Fring&#34;&gt;get_object_ring()&lt;/a&gt;方法来访问正确
的环。然后，它有责任通过header X -Backend-Storage-Policy-Index将索引信息而不是
策略名称传递给后端服务器。走另一条路，proxy还会从返回到客户端的标头中删除索引，并确保它们只能看到友好的策略名称。&lt;/p&gt;

&lt;h3 id=&#34;on-disk-storage&#34;&gt;On Disk Storage&lt;/h3&gt;

&lt;p&gt;每个策略在后端服务器上都有自己的目录，并由其存储策略索引标识。按策略索引组织后
端目录结构有助于跟踪事物，并允许在策略之间共享磁盘，这可能是有意义的也可能没有意义，具体取决于提供者的需求。稍后会详细介绍，但现在请注意以下目录命名约定：&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;/objects 映射到与Policy-0关联的对象&lt;/li&gt;
&lt;li&gt;/objects-N 映射到存储策略索引#N&lt;/li&gt;
&lt;li&gt;/async_pending 映射到Policy-0的异步挂起更新&lt;/li&gt;
&lt;li&gt;/async_pending-N 映射到存储策略索引#N的异步挂起更新&lt;/li&gt;
&lt;li&gt;/tmp 映射到Policy-0的DiskFile临时目录&lt;/li&gt;
&lt;li&gt;/tmp-N 映射到策略索引#N的DiskFile临时目录&lt;/li&gt;
&lt;li&gt;/quarantined/objects 映射到Policy-0的隔离目录&lt;/li&gt;
&lt;li&gt;/quarantined/objects-N 映射到策略索引#N的隔离目录&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;请注意，这些目录名实际上由特定的Diskfile实现拥有，上面显示的名称由默认的Diskfile使用。&lt;/p&gt;

&lt;h3 id=&#34;对象服务&#34;&gt;对象服务&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.openstack.org/swift/queens/object.html#object-server&#34;&gt;Object Server&lt;/a&gt;不参与直接选择存储策略。但是，由于如何为策略设置后端目录结构，
如前所述，对象服务模块确实起作用。当对象服务获取Diskfile时，它会传入策略索
引并保留实际的目录命名/结构机制给Diskfile。通过传入索引，Diskfile正在使用的实例 将确保数据根据其策略正确定位在树中。&lt;/p&gt;

&lt;p&gt;出于同样的原因，
&lt;a href=&#34;https://docs.openstack.org/swift/queens/object.html#object-updater&#34;&gt;Object Updater&lt;/a&gt;也具有策略意识。如前所述，不同的策略使用不同的异步挂起目录
(async pending directories)，因此更新程序需要知道如何正确扫描它们。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.openstack.org/swift/queens/object.html#object-replicator&#34;&gt;Object Replicator&lt;/a&gt;是策略意识到的是，根据策略，可能需要做大幅度不同的东西，或
者也许不是。例如，处理2x与3x的复制作业的差异是微不足道的;但是，3x和纠删码之
间处理复制的差异绝对不是微不足道的。实际上，术语“replication”实际上并不适合
某些策略，如纠删码;但是，收集和处理工作的大多数框架都很常见。因此，复制器中
的这些功能被用于所有策略，然后对每个策略都需要特定于策略的代码，并在需要时定义策略时添加。&lt;/p&gt;

&lt;p&gt;由于同样的原因，ssync功能具有策略感知功能。某些其他模块可能不会受到明显影响，
但Diskfile所拥有的后端目录结构需要策略索引参数。因此，ssync被策略意识,真的
意味着,传递策略索引。见关于SSYNC的&lt;a href=&#34;https://docs.openstack.org/swift/queens/object.html#module-swift.obj.ssync%5Fsender&#34;&gt;ssync_sender&lt;/a&gt;和 &lt;a href=&#34;https://docs.openstack.org/swift/queens/object.html#module-swift.obj.ssync%5Freceiver&#34;&gt;ssync_receiver&lt;/a&gt;更多信息。&lt;/p&gt;

&lt;p&gt;就Diskfile其本身而言，策略感知就是使用提供的策略索引来管理后端结构。换句话
说，获取Diskfile实例的调用者提供策略索引，并且Diskfile工作就是通过此索引
（however it chooses）保持数据分离，以便策略可以共享相同的媒体/节点（如果需
要）。Diskfile包含实现,列出了前面描述的目录结构，但是它在内部Diskfile; 外部
模块无法了解该细节。提供了一种通用功能，用于根据策略索引映射各种目录名称和/
或字符串。例如，Diskfile定义get_data_dir(),它建立在一个通用的&lt;a href=&#34;https://docs.openstack.org/swift/queens/misc.html#swift.common.storage%5Fpolicy.get%5Fpolicy%5Fstring&#34;&gt;get_policy_string()&lt;/a&gt;之上,以便为各种用法一致地构建策略感知字符串。&lt;/p&gt;

&lt;h3 id=&#34;container-server&#34;&gt;Container Server&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.openstack.org/swift/queens/container.html#container-server&#34;&gt;Container Server&lt;/a&gt;起着存储策略非常重要的作用，它负责处理在容器中策略的指令，预
防坏事,比如改变策略或选择了错误的策略,在没有其它参数或事物被指定的时候（回忆前面讨论的Policy-0与default）。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.openstack.org/swift/queens/container.html#container-updater&#34;&gt;Container Updater&lt;/a&gt;是策略感知的，但是它的工作是非常简单的，通过请求头传相应于
&lt;a href=&#34;https://docs.openstack.org/swift/queens/container.html#container-updater&#34;&gt;Account Server&lt;/a&gt;策略索引。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.openstack.org/swift/queens/container.html#container-backend&#34;&gt;Container Backend&lt;/a&gt;同时负责修改现有的DB schema，以及确保新的DB创建schema是支持存储策略的。容器模式的“按需”迁移允许Swift在没有停机的情况下进行升级（无论行数如何，sqlite的alter语句都很快）。为了支持滚动升级（和降级），对container_stat表的不兼容模式更改将对表进行 container_info，并且该container_stat表将替换为包含INSTEAD OF UPDATE触发器的视图，该触发器使其行为类似于旧表。&lt;/p&gt;

&lt;p&gt;策略索引存储在此处用于报告有关容器的信息以及管理裂脑情景引起的容器及其存储策略之间的差异。此外，在裂脑期间，必须准备容器以跟踪来自多个策略的对象更新，因此对象表还包括 storage_policy_index列。Per-policy对象计数和字节在policy_stat表中使用INSERT和DELETE触发器更新，类似于container_stat直接更新的pre-policy触发器。&lt;/p&gt;

&lt;p&gt;当Container更新container_info表中的reconciler_sync_point条目时，Container
Replicator守护程序将主动迁移旧模式，作为其正常一致性检查过程的一部分 。这确
保了不会遇到任何写入的读取繁重的容器仍将迁移到与存储后策略查询完全兼容，而不
必回退,不必使用旧模式重试查询以向服务容器读取请求。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.openstack.org/swift/queens/container.html#container-sync-daemon&#34;&gt;Container Sync&lt;/a&gt;功能，仅需要策略感知的，因为它访问对象环。因此，它需要从容器信
息中提取策略索引，并使用它从POLICIES global 中选择适当的对象环。&lt;/p&gt;

&lt;h3 id=&#34;account-server&#34;&gt;Account Server&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;https://docs.openstack.org/swift/queens/container.html#container-updater&#34;&gt;Account Server&lt;/a&gt;在存储策略的作用实在有限。当对account发出HEAD请求时（请参阅前面提供的示例），帐户服务器提供存储策略索引，并基于每个策略为客户端构建object_count和byte_count信息。&lt;/p&gt;

&lt;p&gt;由于某些特定于策略的数据库架构更改，account server能够报告每个存储策略对象和
字节数。特定策略的policy_stat表能基于每个策略的信息维护信息（每个策略一行）, 以与
account_stat表相同的方式。该account_stat表仍然用于相同的目的而不会被
policy_stat替换，它保存总帐户统计数据，而policy_stat只是分解数据。后端还负责
通过更改DB schema来迁移pre-storage-policy accounts，并在该时间点, 使用当前
account_stat数据去填充Policy-0 的policy_stat表。&lt;/p&gt;

&lt;p&gt;pre-storage-policy对象和字节数不会随每个对象PUT和DELETE请求一起更新，而是对
account server的容器更新由swift-container-updater异步执行。&lt;/p&gt;

&lt;h3 id=&#34;升级和确认功能&#34;&gt;升级和确认功能&lt;/h3&gt;

&lt;p&gt;升级到具有存储策略支持的Swift版本并不困难，事实上，集群管理员不需要进行任何特
殊的配置更改即可开始。Swift将自动开始使用现有对象环作为default环和Policy-0环。
添加policy 0的声明是完全可选的，在不存在时，给予隐式策略0的名称将是“Policy-0”。让我们出于测试目的，您希望获取已经拥有大量数据的现有集群，并使用存储策略升级到Swift。从那里你想要继续创建一个策略并测试一些东西。你需要做的就是：&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;将所有Swift节点升级到策略感知版本的Swift&lt;/li&gt;
&lt;li&gt;在/etc/swift/swift.conf中定义您的策略&lt;/li&gt;
&lt;li&gt;创建相应的对象环&lt;/li&gt;
&lt;li&gt;创建容器和对象，并按预期确认其放置位置&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;有关引导您完成这些步骤的特定示例，请参阅&lt;a href=&#34;https://docs.openstack.org/swift/queens/policies%5Fsaio.html&#34;&gt;Adding Storage Policies to an Existing SAIO&lt;/a&gt;。&lt;/p&gt;

&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;如果从已启用存储策略的Swift版本降级到不支持策略的旧版本，您将无法访问存储
在索引为0的策略之外的任何数据，但这些对象将显示在容器列表中（如果有网络分
区和un-reconciled对象，可能会重复）。在启用其他存储策略以确保为客户提供一
致的API体验之前，对升级的部署执行任何必要的集成测试非常重要。一旦暴露多个存储策略，请勿降级到不支持存储策略的Swift版本。&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>官方中文文档 openstack swift overview reaper</title>
      <link>https://b.qqbb.app/post/translation-openstack-swift-overview-reaper/</link>
      <pubDate>Mon, 21 Jan 2019 00:00:00 -0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/translation-openstack-swift-overview-reaper/</guid>
      
        <description>

&lt;p&gt;&lt;a href=&#34;https://docs.openstack.org/swift/queens/overview%5Freaper.html&#34;&gt;https://docs.openstack.org/swift/queens/overview%5Freaper.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;账户收割者&lt;/p&gt;

&lt;p&gt;更新时间：2019-01-15 02:30&lt;/p&gt;

&lt;p&gt;帐户收割者在后台删除已删除帐户中的数据。&lt;/p&gt;

&lt;p&gt;如果reseller在帐户的存储URL上发出DELETE请求，则会将帐户标记为删除。这只是将
DELETED值放入帐户数据库（和副本）account_stat表的状态列中，说明稍后应删除该帐户的数据。&lt;/p&gt;

&lt;p&gt;通常没有设定的保留时间且没有取消删除; 假设reseller将实施此类功能，并且只有在真正希望删除帐户的数据时才在帐户上调用DELETE。但是，为了保护Swift群集帐户免受不正确或错误删除请求的影响，您可以在account-server.conf的[account-reaper]部分设置delay_reaping值，以延迟实际删除数据。目前，取消删除帐户没有任何效用; 必须直接更新帐户数据库副本，将status列设置为空字符串并将put_timestamp更新为大于delete_timestamp。（在TODO列表上正在编写一个实用程序来执行此任务，最好是通过REST调用。）&lt;/p&gt;

&lt;p&gt;帐户收割机在每个帐户服务器上运行，并偶尔扫描服务器以查找标记为删除的帐户数据库。它只会在服务器是主节点的帐户上触发，因此多个帐户服务器并非都在尝试同时执行相同的工作。使用多个服务器删除一个帐户可能会提高删除速度，但需要协调，因此不会重复工作。速度确实不是数据删除所关注的问题，并且通常不会删除大型帐户。&lt;/p&gt;

&lt;p&gt;帐户本身的删除过程非常简单。对于帐户中的每个容器，将删除每个对象，然后删除容器。
任何失败的删除请求都不会停止整个过程，但会导致整个过程最终失败（例如，如果对象删
除超时，则以后无法删除容器，因此帐户也无法删除）。整个过程即使在发生故障时也会继
续，因此不会因为一个麻烦的地点而无法收回集群空间。帐户收割者将继续尝试删除帐户，
直到它最终变为空，此时db_replicator中的数据库回收进程最终将删除数据库文件。&lt;/p&gt;

&lt;p&gt;有时，持久性错误状态可能会阻止某些对象或容器被删除。如果发生这种情况，您将在日志中看到诸如“Account &lt;name&gt; has not been reaped since &lt;date&gt;”的消息。您可以使用account-server.conf文件的[account-reaper]部分中的reap_warn_after值来控制何时记录此值。默认情况下，是30天。&lt;/p&gt;

&lt;h2 id=&#34;历史&#34;&gt;历史&lt;/h2&gt;

&lt;p&gt;首先，考虑通过完全外部调用删除帐户的简单方法，因为它不需要对系统进行任何更改。所有数据都将通过公共REST API以与实际用户相同的方式删除。但是，缺点是它会使用代理资源并在不需要时记录所有内容。此外，它可能需要一个或两个专用服务器，仅用于发出删除请求。&lt;/p&gt;

&lt;p&gt;还考虑了一种完全自下而上的方法，其中对象和容器服务器偶尔会扫描它们所持有的数据并
检查帐户是否被删除，如果是，则删除数据。好处是回收的速度，对代理或日志记录没有影
响，但缺点是几乎100％的扫描都会导致无缘无故地创建大量I/O负载。&lt;/p&gt;

&lt;p&gt;还考虑了更多以容器服务器为中心的方法，其中帐户服务器将所有容器标记为删除，容器服
务器将删除每个容器中的对象然后删除自己。这对于拥有大量容器的帐户仍然可以快速回收，
但具有相当大的负载峰值的缺点。可以减慢这个过程以减轻负载峰值的可能性，但是就会失
去快速回收的好处，而剩下的只是一个更复杂的过程。此外，扫描所有容器以查找标记为删
除的容器，而大多数容器似乎不会浪费。db_replicator可以在执行复制扫描时执行此操作，
但它必须生成并跟踪看起来不必要复杂的删除过程。&lt;/p&gt;

&lt;p&gt;最后，如上所述，以帐户服务器为中心的方法似乎是最好的。&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>官方中文文档 openstack swift overview rings</title>
      <link>https://b.qqbb.app/post/jwl/swift-not-org/translation-openstack-swift-overview-rings/</link>
      <pubDate>Mon, 21 Jan 2019 00:00:00 -0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/jwl/swift-not-org/translation-openstack-swift-overview-rings/</guid>
      
        <description>

&lt;p&gt;&lt;a href=&#34;https://docs.openstack.org/swift/queens/overview_ring.html&#34;&gt;https://docs.openstack.org/swift/queens/overview_ring.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;OpenStack Docs: The Rings&lt;/p&gt;

&lt;h2 id=&#34;the-rings&#34;&gt;The Rings&lt;/h2&gt;

&lt;p&gt;updated: 2019-01-15 02:30&lt;/p&gt;

&lt;h1 id=&#34;the-rings-the-rings-permalink-to-this-headline&#34;&gt;The Rings&lt;a href=&#34;#the-rings&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h1&gt;

&lt;p&gt;The rings determine where data should reside in the cluster. There is a separate ring for account databases, container databases, and individual object storage policies but each ring works in the same way. These rings are externally managed. The server processes themselves do not modify the rings; they are instead given new rings modified by other tools.&lt;/p&gt;

&lt;p&gt;环确定数据应驻留在集群中的位置。帐户数据库，容器数据库和单个对象存储策略有一个单独的环，但每个环以相同的方式工作。这些环是外部管理的。服务进程本身不会修改环; 相反，它们被赋予了由其他工具修改的新环。(译注：ring不能被修改，只能产生新ring)&lt;/p&gt;

&lt;p&gt;The ring uses a configurable number of bits from the MD5 hash of an item’s path as a partition index that designates the device(s) on which that item should be stored. The number of bits kept from the hash is known as the partition power, and 2 to the partition power indicates the partition count. Partitioning the full MD5 hash ring allows the cluster components to process resources in batches. This ends up either more efficient or at least less complex than working with each item separately or the entire cluster all at once.&lt;/p&gt;

&lt;p&gt;（译注：关于下面2段文字，先看&lt;a href=&#34;https://b.qqbb.app/post/analysis-openstack-swift-overview-ring/&#34;&gt;这里&lt;/a&gt;，可能效果要好很多。我第一次看的时候，全蒙）&lt;/p&gt;

&lt;p&gt;环使用来自项目路径的MD5哈希的可配置位数作为分区索引（partition index），该分区索引指定应该存储该项目的设备。从散列中保留的比特数称为分区功率（partition power），2的分区功率次方表示分区总数（partition count）。对完整MD5哈希环进行分区允许群集组件批量处理资源。与单独处理每个项目或同时处理整个集群相比，这最终会更有效或至少更简单。(译注：比如&lt;a href=&#34;https://docs.openstack.org/swift/queens/install/initial-rings.html#create-account-ring&#34;&gt;initial-rings&lt;/a&gt;时，你配置的是&lt;code&gt;swift-ring-builder account.builder create 10 3 1&lt;/code&gt;, 则partition power是10，partition count是1024=2**10)&lt;/p&gt;

&lt;p&gt;Another configurable value is the replica count, which indicates how many devices to assign for each partition in the ring. By having multiple devices responsible for each partition, the cluster can recover from drive or network failures.&lt;/p&gt;

&lt;p&gt;另一个可配置的值是副本数(译注：同理，此配置副本数是3)，它指示为环中的每个分区分配的设备数量。通过让多个设备负责每个分区，群集可以从驱动器或网络故障中恢复。&lt;/p&gt;

&lt;p&gt;Devices are added to the ring to describe the capacity available for partition replica assignments. Devices are placed into failure domains consisting of region, zone, and server. Regions can be used to describe geographical systems characterized by lower bandwidth or higher latency between machines in different regions. Many rings will consist of only a single region. Zones can be used to group devices based on physical locations, power separations, network separations, or any other attribute that would lessen multiple replicas being unavailable at the same time.&lt;/p&gt;

&lt;p&gt;将设备添加到环中以描述可用于分区副本分配的容量。设备被置于由region, zone, 和 server组成的故障域中。Regions可用于描述以不同区域中的机器之间的较低带宽或较高等待时间为特征的地理系统。许多环只有一个region。Zones可用于根据物理位置，电源分离，网络分离或任何其他属性来对设备进行分组，这些属性可以减少同一时间多个副本都不可用的情形发生。&lt;/p&gt;

&lt;p&gt;Devices are given a weight which describes the relative storage capacity contributed by the device in comparison to other devices.&lt;/p&gt;

&lt;p&gt;给予设备权重，该权重描述了设备与其他设备相比所贡献的相对存储容量。&lt;/p&gt;

&lt;p&gt;When building a ring, replicas for each partition will be assigned to devices according to the devices’ weights. Additionally, each replica of a partition will preferentially be assigned to a device whose failure domain does not already have a replica for that partition. Only a single replica of a partition may be assigned to each device - you must have at least as many devices as replicas.&lt;/p&gt;

&lt;p&gt;构建环时，将根据设备的权重为每个分区分配副本。此外，分区的每个副本将优先分配给其故障域尚未具有该分区的副本的设备。只能为每个设备分配一个分区的单个副本 - 您必须至少拥有与副本一样多的设备。（译注：也就是设备数量最少为3）&lt;/p&gt;

&lt;h2 id=&#34;ring-builder-ring-builder-permalink-to-this-headline&#34;&gt;Ring Builder&lt;a href=&#34;#ring-builder&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;The rings are built and managed manually by a utility called the ring-builder. The ring-builder assigns partitions to devices and writes an optimized structure to a gzipped, serialized file on disk for shipping out to the servers. The server processes check the modification time of the file occasionally and reload their in-memory copies of the ring structure as needed. Because of how the ring-builder manages changes to the ring, using a slightly older ring usually just means that for a subset of the partitions the device for one of the replicas will be incorrect, which can be easily worked around.&lt;/p&gt;

&lt;p&gt;环由称为环构建器的实用程序手动构建和管理。环构建器将分区分配给设备，并将优化的结构的gzip压缩序列化文件写入磁盘上，以便传送到servers。服务进程偶尔检查文件的修改时间，并根据需要重新加载环结构的内存副本。由于环构建器管理环的变化，使用稍微较旧的环通常只意味着对于一个分区的子集，其中一个副本的设备将是不正确的，这可以很容易地解决。&lt;/p&gt;

&lt;p&gt;The ring-builder also keeps a separate builder file which includes the ring information as well as additional data required to build future rings. It is very important to keep multiple backup copies of these builder files. One option is to copy the builder files out to every server while copying the ring files themselves. Another is to upload the builder files into the cluster itself. Complete loss of a builder file will mean creating a new ring from scratch, nearly all partitions will end up assigned to different devices, and therefore nearly all data stored will have to be replicated to new locations. So, recovery from a builder file loss is possible, but data will definitely be unreachable for an extended time.&lt;/p&gt;

&lt;p&gt;环构建器还保留单独的构建器文件，其中包括环信息以及构建未来环所需的其他数据。保留这些构建器文件的多个备份副本非常重要。一种选择是将构建器文件复制到每个服务器的时候，同时复制环文件。另一种方法是将构建器文件上载到群集本身。完全丢失构建器文件意味着从头开始创建新环，几乎所有分区最终都将分配给不同的设备，因此几乎所有存储的数据都必须复制到新位置。因此，可以从构建器文件丢失中恢复，但数据肯定会在较长时间内无法访问。&lt;/p&gt;

&lt;h2 id=&#34;ring-data-structure-ring-data-structure-permalink-to-this-headline&#34;&gt;Ring Data Structure&lt;a href=&#34;#ring-data-structure&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;The ring data structure consists of three top level fields: a list of devices in the cluster, a list of lists of device ids indicating partition to device assignments, and an integer indicating the number of bits to shift an MD5 hash to calculate the partition for the hash.&lt;/p&gt;

&lt;p&gt;环数据结构由三个顶级字段组成：集群中的设备列表，指出分区分配到设备的设备ID列表（译注：下称“分区分配列表”），以及一个整数。这个整数，用于，计算分区哈希过程中的一个MD5哈希的移位位数(译注：源码中是_part_shift，配置示例就是：22=32-10)。&lt;/p&gt;

&lt;p&gt;（译注：根据下文知道，这三个字段名，在源码中，分别为：&lt;code&gt;devs&lt;/code&gt;，&lt;code&gt;_replica2part2dev_id&lt;/code&gt;，&lt;code&gt;_part_shift&lt;/code&gt;）&lt;/p&gt;

&lt;h3 id=&#34;list-of-devices-list-of-devices-permalink-to-this-headline&#34;&gt;List of Devices&lt;a href=&#34;#list-of-devices&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;The list of devices is known internally to the Ring class as &lt;code&gt;devs&lt;/code&gt;. Each item in the list of devices is a dictionary with the following keys:&lt;/p&gt;

&lt;p&gt;Ring类内部已知设备列表用&lt;code&gt;devs&lt;/code&gt;表示。设备列表中的每个项目都是包含以下键的字典：（译注：示例可看&lt;a href=&#34;https://b.qqbb.app/post/analysis-openstack-swift-overview-ring/&#34;&gt;这里&lt;/a&gt; ）&lt;/p&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;id&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;integer&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The index into the list of devices.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;zone&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;integer&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The zone in which the device resides.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;region&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;integer&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The region in which the zone resides.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;weight&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;float&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The relative weight of the device in comparison to other devices. This usually corresponds directly to the amount of disk space the device has compared to other devices. For instance a device with 1 terabyte of space might have a weight of 100.0 and another device with 2 terabytes of space might have a weight of 200.0. This weight can also be used to bring back into balance a device that has ended up with more or less data than desired over time. A good average weight of 100.0 allows flexibility in lowering the weight later if necessary.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;ip&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;string&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The IP address or hostname of the server containing the device.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;port&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;int&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The TCP port on which the server process listens to serve requests for the device.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;device&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;string&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The on-disk name of the device on the server. For example: sdb1&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;meta&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;string&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;A general-use field for storing additional information for the device. This information isn’t used directly by the server processes, but can be useful in debugging. For example, the date and time of installation and hardware manufacturer could be stored here.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&#34;left&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;&lt;/th&gt;
&lt;th align=&#34;left&#34;&gt;&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;

&lt;tbody&gt;
&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;id&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;integer&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;索引到设备列表.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;zone&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;integer&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The zone in which the device resides.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;region&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;integer&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;The region in which the zone resides.&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;weight&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;float&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;与其他设备相比，设备的相对重量。这通常直接对应于设备与其他设备相比的磁盘空间量。例如，具有1TB空间的设备可能具有100.0的权重，而具有2TB空间的另一设备可具有200.0的权重。这个权重还可以用来恢复一个设备，该设备最终会有比预期更多或更少的数据。良好的平均重量100.0可以在必要时灵活地降低重量。&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;ip&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;string&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;包含设备的服务器的IP地址或主机名。&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;port&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;int&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;服务器进程侦听的TCP端口为设备提供请求。&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;device&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;string&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;服务器上设备的磁盘名称。例如：sdb1&lt;/td&gt;
&lt;/tr&gt;

&lt;tr&gt;
&lt;td align=&#34;left&#34;&gt;meta&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;string&lt;/td&gt;
&lt;td align=&#34;left&#34;&gt;用于存储设备的附加信息的通用字段。服务器进程不直接使用此信息，但在调试时可能很有用。例如，安装的日期和时间以及硬件制造商可以存储在此处。&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;Note&lt;/p&gt;

&lt;p&gt;The list of devices may contain holes, or indexes set to &lt;code&gt;None&lt;/code&gt;, for devices that have been removed from the cluster. However, device ids are reused. Device ids are reused to avoid potentially running out of device id slots when there are available slots (from prior removal of devices). A consequence of this device id reuse is that the device id (integer value) does not necessarily correspond with the chronology of when the device was added to the ring. Also, some devices may be temporarily disabled by setting their weight to &lt;code&gt;0.0&lt;/code&gt;. To obtain a list of active devices (for uptime polling, for example) the Python code would look like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;devices&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_iter_devs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;注意&lt;/p&gt;

&lt;p&gt;对于已从群集中删除的设备，设备列表可能包含holes或索引设置为&lt;code&gt;None&lt;/code&gt;。但是，设备ID可以重复使用。重新使用设备ID以避免在有可用插槽（从先前移除设备）时可能耗尽设备ID插槽。此设备ID重用的结果是设备ID（整数值）不一定与设备添加到环中的时间顺序相对应。此外，可以通过将其权重设置为 &lt;code&gt;0.0&lt;/code&gt;以暂时禁用某些设备。要获取活动设备列表（例如，用于正常运行时间轮询），Python代码将如下所示：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;devices&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;nb&#34;&gt;list&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_iter_devs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;())&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;h3 id=&#34;partition-assignment-list-partition-assignment-list-permalink-to-this-headline&#34;&gt;Partition Assignment List&lt;a href=&#34;#partition-assignment-list&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;The partition assignment list is known internally to the Ring class as &lt;code&gt;_replica2part2dev_id&lt;/code&gt;. This is a list of &lt;code&gt;array(&#39;H&#39;)&lt;/code&gt;s, one for each replica. Each &lt;code&gt;array(&#39;H&#39;)&lt;/code&gt; has a length equal to the partition count for the ring. Each integer in the &lt;code&gt;array(&#39;H&#39;)&lt;/code&gt; is an index into the above list of devices.&lt;/p&gt;

&lt;p&gt;分区分配列表在Ring类内部表示为 &lt;code&gt;_replica2part2dev_id&lt;/code&gt;。这是&lt;code&gt;array(&#39;H&#39;)&lt;/code&gt;的列表（list），每个副本一个。每个&lt;code&gt;array(&#39;H&#39;)&lt;/code&gt;的长度等于环的分区数（译注：安装示例为：1024=2**10）。其中的&lt;code&gt;array(&#39;H&#39;)&lt;/code&gt;上的每个整数都是上述的设备列表的索引（译注：也就是上面 List of Devices 小节中的表中的ID字段值）。&lt;/p&gt;

&lt;p&gt;So, to create a list of device dictionaries assigned to a partition, the Python code would look like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;devices&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;devs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;part2dev_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;partition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]]&lt;/span&gt;
           &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;part2dev_id&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_replica2part2dev_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;因此，创建分配给分区的设备列表的字典，Python代码将如下所示：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;devices&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;devs&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;part2dev_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;[&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;partition&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]]&lt;/span&gt;
           &lt;span class=&#34;k&#34;&gt;for&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;part2dev_id&lt;/span&gt; &lt;span class=&#34;ow&#34;&gt;in&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_replica2part2dev_id&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;&lt;code&gt;array(&#39;H&#39;)&lt;/code&gt; is used for memory conservation as there may be millions of partitions.&lt;/p&gt;

&lt;p&gt;&lt;code&gt;array(&#39;H&#39;)&lt;/code&gt; 用于内存保护，因为可能有数百万个分区。&lt;/p&gt;

&lt;h3 id=&#34;partition-shift-value-partition-shift-value-permalink-to-this-headline&#34;&gt;Partition Shift Value&lt;a href=&#34;#partition-shift-value&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;The partition shift value is known internally to the Ring class as &lt;code&gt;_part_shift&lt;/code&gt;. This value is used to shift an MD5 hash of an item’s path to calculate the partition on which the data for that item should reside. Only the top four bytes of the hash are used in this process. For example, to compute the partition for the path &lt;code&gt;/account/container/object&lt;/code&gt;, the Python code might look like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;objhash&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;md5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;/account/container/object&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;digest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;partition&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unpack_from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;gt;I&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;objhash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_part_shift&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;分区移位值在Ring类内部为 &lt;code&gt;_part_shift&lt;/code&gt;。此值用于移动项目路径的MD5哈希值，以计算该项目的数据应驻留在的分区。在此过程中仅使用散列的前四个字节。例如，要计算路径的分区&lt;code&gt;/account/container/object&lt;/code&gt;，Python代码可能如下所示：&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-python&#34; data-lang=&#34;python&#34;&gt;&lt;span class=&#34;n&#34;&gt;objhash&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;md5&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;/account/container/object&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;digest&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;()&lt;/span&gt;
&lt;span class=&#34;n&#34;&gt;partition&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;=&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;struct&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;unpack_from&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;(&lt;/span&gt;&lt;span class=&#34;s1&#34;&gt;&amp;#39;&amp;gt;I&amp;#39;&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;,&lt;/span&gt; &lt;span class=&#34;n&#34;&gt;objhash&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;)[&lt;/span&gt;&lt;span class=&#34;mi&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;p&#34;&gt;]&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&#34;bp&#34;&gt;self&lt;/span&gt;&lt;span class=&#34;o&#34;&gt;.&lt;/span&gt;&lt;span class=&#34;n&#34;&gt;_part_shift&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;For a ring generated with partition power &lt;code&gt;P&lt;/code&gt;, the partition shift value is &lt;code&gt;32 - P&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;对于使用分区功率&lt;code&gt;P&lt;/code&gt;生成的环，分区移位值为&lt;code&gt;32 - P&lt;/code&gt; 。&lt;/p&gt;

&lt;h3 id=&#34;fractional-replicas-fractional-replicas-permalink-to-this-headline&#34;&gt;Fractional Replicas&lt;a href=&#34;#fractional-replicas&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;A ring is not restricted to having an integer number of replicas. In order to support the gradual changing of replica counts, the ring is able to have a real number of replicas.&lt;/p&gt;

&lt;p&gt;环不限于具有整数个副本。为了支持副本计数的逐渐变化，环能够具有实数值的副本。&lt;/p&gt;

&lt;p&gt;When the number of replicas is not an integer, the last element of &lt;code&gt;_replica2part2dev_id&lt;/code&gt; will have a length that is less than the partition count for the ring. This means that some partitions will have more replicas than others. For example, if a ring has &lt;code&gt;3.25&lt;/code&gt; replicas, then 25% of its partitions will have four replicas, while the remaining 75% will have just three.&lt;/p&gt;

&lt;p&gt;当副本的数量不是整数时，&lt;code&gt;_replica2part2dev_id&lt;/code&gt; 最后一个元素的长度将小于环的分区数。这意味着某些分区将具有比其他分区更多的副本。例如，如果一个环有3.25副本，那么其25％的分区将有四个副本，而剩下的75％将只有三个副本。&lt;/p&gt;

&lt;p&gt;（译注：3.25 = 4*0.25 + 3*0.75）&lt;/p&gt;

&lt;h3 id=&#34;dispersion-dispersion-permalink-to-this-headline&#34;&gt;Dispersion&lt;a href=&#34;#dispersion&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;With each rebalance, the ring builder calculates a dispersion metric. This is the percentage of partitions in the ring that have too many replicas within a particular failure domain.&lt;/p&gt;

&lt;p&gt;对于每个重新平衡，环构建器计算分散度。这是环中具有特定故障域内太多副本的分区的百分比。&lt;/p&gt;

&lt;p&gt;For example, if you have three servers in a cluster but two replicas for a partition get placed onto the same server, that partition will count towards the dispersion metric.&lt;/p&gt;

&lt;p&gt;例如，如果群集中有三台服务器，但分区的两个副本放置在同一服务器上，则该分区将计入分散度量标准。&lt;/p&gt;

&lt;p&gt;（译注：因为这个分区，并不分散）&lt;/p&gt;

&lt;p&gt;A lower dispersion value is better, and the value can be used to find the proper value for “overload”.&lt;/p&gt;

&lt;p&gt;较低的分散度更好，并且该值可用于找到“overload”的适当值。&lt;/p&gt;

&lt;h3 id=&#34;overload-overload-permalink-to-this-headline&#34;&gt;Overload&lt;a href=&#34;#overload&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;The ring builder tries to keep replicas as far apart as possible while still respecting device weights. When it can’t do both, the overload factor determines what happens. Each device may take some extra fraction of its desired partitions to allow for replica dispersion; once that extra fraction is exhausted, replicas will be placed closer together than is optimal for durability.&lt;/p&gt;

&lt;p&gt;环构建器尝试尽可能远离replicas，同时仍然尊重设备weights。如果不能同时做到这两点，overload决定了会发生什么。每个设备可以占用其所需分区的一些额外部分以允许复制品分散; 一旦额外的部分耗尽，复制品将被放置在一起，而不是最佳的耐久性。&lt;/p&gt;

&lt;p&gt;Essentially, the overload factor lets the operator trade off replica dispersion (durability) against device balance (uniform disk usage).&lt;/p&gt;

&lt;p&gt;从本质上讲，过载因子可以让操作员在设备平衡（统一磁盘使用率）之间权衡复制分散（耐久性）。&lt;/p&gt;

&lt;p&gt;The default overload factor is &lt;code&gt;0&lt;/code&gt;, so device weights will be strictly followed.&lt;/p&gt;

&lt;p&gt;默认的过载因子是&lt;code&gt;0&lt;/code&gt;，因此将严格遵循设备权重。&lt;/p&gt;

&lt;p&gt;With an overload factor of &lt;code&gt;0.1&lt;/code&gt;, each device will accept 10% more partitions than it otherwise would, but only if needed to maintain dispersion.&lt;/p&gt;

&lt;p&gt;在过载因子的情况下&lt;code&gt;0.1&lt;/code&gt;，每个设备将接受比其他情况多10％的分区，但仅在需要保持分散时。&lt;/p&gt;

&lt;p&gt;Example: Consider a 3-node cluster of machines with equal-size disks; let node A have 12 disks, node B have 12 disks, and node C have only 11 disks. Let the ring have an overload factor of &lt;code&gt;0.1&lt;/code&gt; (10%).&lt;/p&gt;

&lt;p&gt;示例：考虑具有相等大小磁盘的3节点计算机群集; 让节点A有12个磁盘，节点B有12个磁盘，节点C只有11个磁盘。让环的过载系数为0.1（10％）。&lt;/p&gt;

&lt;p&gt;Without the overload, some partitions would end up with replicas only on nodes A and B. However, with the overload, every device is willing to accept up to 10% more partitions for the sake of dispersion. The missing disk in C means there is one disk’s worth of partitions that would like to spread across the remaining 11 disks, which gives each disk in C an extra 9.09% load. Since this is less than the 10% overload, there is one replica of each partition on each node.&lt;/p&gt;

&lt;p&gt;如果没有过载，一些分区最终只会在节点A和B上出现副本。但是，由于过载，每个设备都愿意为了分散而接受多达10％的分区。C中丢失的磁盘意味着有一个磁盘的分区值要分布在剩余的11个磁盘上，这为C中的每个磁盘提供了额外的9.09％负载。由于这小于10％的过载，每个节点上的每个分区都有一个副本。&lt;/p&gt;

&lt;p&gt;However, this does mean that the disks in node C will have more data on them than the disks in nodes A and B. If 80% full is the warning threshold for the cluster, node C’s disks will reach 80% full while A and B’s disks are only 72.7% full.&lt;/p&gt;

&lt;p&gt;但是，这确实意味着节点C中的磁盘将拥有比节点A和B中的磁盘更多的数据。如果80％已满是群集的警告阈值，则节点C的磁盘将达到80％满，而A和B的磁盘只有72.7％已满。&lt;/p&gt;

&lt;h2 id=&#34;partition-replica-terminology-partition-replica-terminology-permalink-to-this-headline&#34;&gt;Partition &amp;amp; Replica Terminology&lt;a href=&#34;#partition-replica-terminology&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;All descriptions of consistent hashing describe the process of breaking the keyspace up into multiple ranges (vnodes, buckets, etc.) - many more than the number of “nodes” to which keys in the keyspace must be assigned. Swift calls these ranges partitions - they are partitions of the total keyspace.&lt;/p&gt;

&lt;p&gt;所有关于一致性散列的描述都描述了将键空间（keyspace）分解为多个范围（vnode，buckets等）的过程 - 比必须分配键空间中的键的“节点”的数量多得多。Swift调用这些范围分区 - 它们是总键空间的分区。&lt;/p&gt;

&lt;p&gt;Each partition will have multiple replicas. Every replica of each partition must be assigned to a device in the ring. When describing a specific replica of a partition (like when it’s assigned a device) it is described as a part-replica in that it is a specific replica of the specific partition. A single device will likely be assigned different replicas from many partitions, but it may not be assigned multiple replicas of a single partition.&lt;/p&gt;

&lt;p&gt;每个分区都有多个副本。必须将每个分区的每个副本分配给环中的设备。在描述分区的特定副本时（例如，当它被分配设备时），它被描述为 部分副本(part-replica)，因为它是特定分区的特定副本。单个设备可能会从许多分区分配不同的副本，但可能不会为单个分区分配多个副本。&lt;/p&gt;

&lt;p&gt;(译注：这个是肯定的。因为，创造出 partition的目的，就是为了让单个设备存放多个partition。而单个partition都有一个唯一的 partition index，同时：在xfs文件系统中，同一个文件夹下，不允许有2个同名文件夹，所以单个设备不会为单个分区分配多个副本。在上面提过的&lt;a href=&#34;https://b.qqbb.app/post/analysis-openstack-swift-overview-ring/&#34;&gt;示例中&lt;/a&gt;，在&lt;code&gt;/src/node/sdb/objects/&lt;/code&gt;下，不能同时有多个partiton index为&lt;code&gt;119&lt;/code&gt;的文件夹)&lt;/p&gt;

&lt;p&gt;The total number of partitions in a ring is calculated as &lt;code&gt;2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt;. The total number of part-replicas in a ring is calculated as &lt;code&gt;&amp;lt;replica-count&amp;gt; * 2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;环中分区的总数计算为&lt;code&gt;2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt;。环中部分副本的总数计算为&lt;code&gt;&amp;lt;replica-count&amp;gt; * 2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt; 。（译注：安装示例，分区总数:&lt;code&gt;2**10&lt;/code&gt;，part-replicas总数为 &lt;code&gt;3*2**10&lt;/code&gt;)&lt;/p&gt;

&lt;p&gt;When considering a device’s weight it is useful to describe the number of part-replicas it would like to be assigned. A single device, regardless of weight, will never hold more than &lt;code&gt;2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt; part-replicas because it can not have more than one replica of any partition assigned. The number of part-replicas a device can take by weights is calculated as its parts-wanted. The true number of part-replicas assigned to a device can be compared to its parts-wanted similarly to a calculation of percentage error - this deviation in the observed result from the idealized target is called a device’s balance.&lt;/p&gt;

&lt;p&gt;在考虑设备的权重时，描述它希望分配的部分副本的数量是有用的。无论weight如何，单个设备永远不会超过&lt;code&gt;2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt;个部分副本，因为它不能分配任何一个分区的多个副本给同一个设备。设备可以按weights计算的部分副本的数量按其parts-wanted计算。分配给设备的部分副本的真实数量可以与其parts-wanted进行比较，类似于计算百分比误差 - 观察结果与理想目标的偏差称为设备平衡（balance）。&lt;/p&gt;

&lt;p&gt;When considering a device’s failure domain it is useful to describe the number of part-replicas it would like to be assigned. The number of part-replicas wanted in a failure domain of a tier is the sum of the part-replicas wanted in the failure domains of its sub-tier. However, collectively when the total number of part-replicas in a failure domain exceeds or is equal to &lt;code&gt;2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt; it is most obvious that it’s no longer sufficient to consider only the number of total part-replicas, but rather the fraction of each replica’s partitions. Consider for example a ring with 3 replicas and 3 servers: while dispersion requires that each server hold only ⅓ of the total part-replicas, placement is additionally constrained to require &lt;code&gt;1.0&lt;/code&gt; replica of &lt;em&gt;each&lt;/em&gt; partition per server. It would not be sufficient to satisfy dispersion if two devices on one of the servers each held a replica of a single partition, while another server held none. By considering a decimal fraction of one replica’s worth of partitions in a failure domain we can derive the total part-replicas wanted in a failure domain (&lt;code&gt;1.0 * 2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt;). Additionally we infer more about which part-replicas must go in the failure domain. Consider a ring with three replicas and two zones, each with two servers (four servers total). The three replicas worth of partitions will be assigned into two failure domains at the zone tier. Each zone must hold more than one replica of some partitions. We represent this improper fraction of a replica’s worth of partitions in decimal form as &lt;code&gt;1.5&lt;/code&gt; (&lt;code&gt;3.0 / 2&lt;/code&gt;). This tells us not only the &lt;em&gt;number&lt;/em&gt; of total partitions (&lt;code&gt;1.5 * 2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt;) but also that &lt;em&gt;each&lt;/em&gt; partition must have at least one replica in this failure domain (in fact &lt;code&gt;0.5&lt;/code&gt; of the partitions will have 2 replicas). Within each zone the two servers will hold &lt;code&gt;0.75&lt;/code&gt; of a replica’s worth of partitions - this is equal both to “the fraction of a replica’s worth of partitions assigned to each zone (&lt;code&gt;1.5&lt;/code&gt;) divided evenly among the number of failure domains in its sub-tier (2 servers in each zone, i.e. &lt;code&gt;1.5 / 2&lt;/code&gt;)” but &lt;em&gt;also&lt;/em&gt; “the total number of replicas (&lt;code&gt;3.0&lt;/code&gt;) divided evenly among the total number of failure domains in the server tier (2 servers × 2 zones = 4, i.e. &lt;code&gt;3.0 / 4&lt;/code&gt;)”. It is useful to consider that each server in this ring will hold only &lt;code&gt;0.75&lt;/code&gt; of a replica’s worth of partitions which tells that any server should have at most one replica of a given partition assigned. In the interests of brevity, some variable names will often refer to the concept representing the fraction of a replica’s worth of partitions in decimal form as &lt;em&gt;replicanths&lt;/em&gt; - this is meant to invoke connotations similar to ordinal numbers as applied to fractions, but generalized to a replica instead of a four*th* or a fif*th*. The “n” was probably thrown in because of Blade Runner.&lt;/p&gt;

&lt;p&gt;在考虑设备的故障域时，描述它希望分配的部分副本的数量是有用的。在层的故障域中需要的部分副本的数量是其子层的故障域中所需的部分副本的总和。但是，当故障域中的部分副本的总数超过或等于&lt;code&gt;2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt;时，最明显的是，仅考虑总部分副本的数量，而不是仅考虑每个副本的分区的分数，这已经不够了。例如，考虑一个具有3个副本和3个服务器的环：虽然分散度要求每个服务器仅保留总部分副本中的1/3，但是，另外，placement必须限制为 &lt;em&gt;each&lt;/em&gt; 服务器需要&lt;code&gt;1.0&lt;/code&gt;个副本。如果其中一个服务器上的两个设备都拥有单个分区的副本，而另一个服务器没有保留，则是不够满足分散度的。通过考虑故障域中一个副本的分区的小数部分，我们可以导出故障域中所需的总部分副本(&lt;code&gt;1.0 * 2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt;)。此外，我们更多地推断出哪些部分副本必须在故障域中进行。考虑一个带有三个副本和两个zones的环，每个zones有两个服务器（总共四个服务器）。三个副本的分区将分配到zones层的两个故障域。每个zones必须包含某些分区的多于1个副本。We represent this improper fraction of a replica’s worth of partitions in decimal form as &lt;code&gt;1.5&lt;/code&gt; (&lt;code&gt;3.0 / 2&lt;/code&gt;). 这就告诉我们，不仅总分区数量（&lt;code&gt;1.5 * 2 ** &amp;lt;part-power&amp;gt;&lt;/code&gt;），而且 &lt;em&gt;each&lt;/em&gt; 分区在该故障域中必须至少有一个副本（其实&lt;code&gt;0.5&lt;/code&gt; of the partitions将有2个副本）。Within each zone the two servers will hold &lt;code&gt;0.75&lt;/code&gt; of a replica’s worth of partitions - this is equal both to “the fraction of a replica’s worth of partitions assigned to each zone (&lt;code&gt;1.5&lt;/code&gt;) divided evenly among the number of failure domains in its sub-tier (2 servers in each zone, i.e. &lt;code&gt;1.5 / 2&lt;/code&gt;)” but &lt;em&gt;also&lt;/em&gt; “the total number of replicas (&lt;code&gt;3.0&lt;/code&gt;) divided evenly among the total number of failure domains in the server tier (2 servers × 2 zones = 4, i.e. &lt;code&gt;3.0 / 4&lt;/code&gt;)”.考虑到此环中的每个服务器仅0.75包含&lt;code&gt;0.75&lt;/code&gt;副本的分区，这有助于告知任何服务器最多只能分配给定分区一个副本。为了简洁起见，一些变量名称通常将表示replica的十进制形式的分区值的概念称为 &lt;em&gt;replicanths&lt;/em&gt; - 这意味着invoke connotations，类似于应用于分数的有序数，但是副本一般化为1，而不是 a four&lt;em&gt;th&lt;/em&gt; or a fif*th*。The “n” was probably thrown in because of Blade Runner.&lt;/p&gt;

&lt;p&gt;（译注：讲真的，上面这一段，不知道在讲啥）&lt;/p&gt;

&lt;h2 id=&#34;building-the-ring-building-the-ring-permalink-to-this-headline&#34;&gt;Building the Ring&lt;a href=&#34;#building-the-ring&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;First the ring builder calculates the replicanths wanted at each tier in the ring’s topology based on weight.&lt;/p&gt;

&lt;p&gt;首先，环构建器根据权重计算环的拓扑中每层所需的replicanths。(译注：也就是计算每层应该有的 replica的理论值)&lt;/p&gt;

&lt;p&gt;Then the ring builder calculates the replicanths wanted at each tier in the ring’s topology based on dispersion.&lt;/p&gt;

&lt;p&gt;然后，环构建器根据dispersion计算环拓扑中每层所需的replicanths。&lt;/p&gt;

&lt;p&gt;Then the ring builder calculates the maximum deviation on a single device between its weighted replicanths and wanted replicanths.&lt;/p&gt;

&lt;p&gt;然后，环构建器计算单个设备在其weighted replicanth和wanted replicanth之间的最大偏差。&lt;/p&gt;

&lt;p&gt;Next we interpolate between the two replicanth values (weighted &amp;amp; wanted) at each tier using the specified overload (up to the maximum required overload). It’s a linear interpolation, similar to solving for a point on a line between two points - we calculate the slope across the max required overload and then calculate the intersection of the line with the desired overload. This becomes the target.&lt;/p&gt;

&lt;p&gt;接下来，我们使用指定的overload（up to the maximum required overload）在每层的两个replicanth值（weighted &amp;amp; wanted）之间进行插值。这是一个线性插值，类似于求解两点之间的直线上的点 - 我们计算最大所需过载的斜率，然后计算该线与所需过载的交点。This becomes the target.&lt;/p&gt;

&lt;p&gt;From the target we calculate the minimum and maximum number of replicas any partition may have in a tier. This becomes the replica-plan.&lt;/p&gt;

&lt;p&gt;从目标，我们计算任何分区在层中可能具有的最小和最大副本数。这成为副本计划（replica-plan）。&lt;/p&gt;

&lt;p&gt;Finally, we calculate the number of partitions that should ideally be assigned to each device based the replica-plan.&lt;/p&gt;

&lt;p&gt;最后，我们根据副本计划计算理想情况下应分配给每个设备的分区数。&lt;/p&gt;

&lt;p&gt;On initial balance (i.e., the first time partitions are placed to generate a ring) we must assign each replica of each partition to the device that desires the most partitions excluding any devices that already have their maximum number of replicas of that partition assigned to some parent tier of that device’s failure domain.&lt;/p&gt;

&lt;p&gt;在初始平衡initial balance（即，第一次放置分区以生成环）时，我们必须将每个分区的每个副本分配给需要最多分区的设备，不包括已分配给某些分区的最大分区副本数的故障域的父层的设备。&lt;/p&gt;

&lt;p&gt;When building a new ring based on an old ring, the desired number of partitions each device wants is recalculated from the current replica-plan. Next the partitions to be reassigned are gathered up. Any removed devices have all their assigned partitions unassigned and added to the gathered list. Any partition replicas that (due to the addition of new devices) can be spread out for better durability are unassigned and added to the gathered list. Any devices that have more partitions than they now desire have random partitions unassigned from them and added to the gathered list. Lastly, the gathered partitions are then reassigned to devices using a similar method as in the initial assignment described above.&lt;/p&gt;

&lt;p&gt;在基于旧环建立新环时，从当前副本计划重新计算每个设备所需的所需分区数。接下来，将收集要重新分配的分区。任何已删除的设备都会将所有已分配的分区取消分配并添加到gathered list中。任何分区副本（由于添加了新设备）可以分散以获得更好的持久性，这些副本是未分配的并添加到收集列表中。任何具有比现在更多分区的设备，都会从它们中取消分配随机分区，并添加到收集列表中。最后，使用与上述初始分配中类似的方法将收集的分区重新分配给设备。&lt;/p&gt;

&lt;p&gt;（译注：简单说，就是通过各种信息，收集设备，用于等会rebalance的时候分配parition）&lt;/p&gt;

&lt;p&gt;Whenever a partition has a replica reassigned, the time of the reassignment is recorded. This is taken into account when gathering partitions to reassign so that no partition is moved twice in a configurable amount of time. This configurable amount of time is known internally to the RingBuilder class as &lt;code&gt;min_part_hours&lt;/code&gt;. This restriction is ignored for replicas of partitions on devices that have been removed, as device removal should only happens on device failure and there’s no choice but to make a reassignment.&lt;/p&gt;

&lt;p&gt;每当分区重新分配副本时，都会记录重新分配的时间。在收集分区以重新分配时会考虑这一点，以便在可配置的时间内不会移动分区两次。这个可配置的时间量在RingBuilder类内部是 &lt;code&gt;min_part_hours&lt;/code&gt;。对于已删除的设备上的分区副本，将忽略此限制，因为设备删除应仅在设备故障时发生，并且除了进行重新分配之外，别无选择。&lt;/p&gt;

&lt;p&gt;The above processes don’t always perfectly rebalance a ring due to the random nature of gathering partitions for reassignment. To help reach a more balanced ring, the rebalance process is repeated a fixed number of times until the replica-plan is fulfilled or unable to be fulfilled (indicating we probably can’t get perfect balance due to too many partitions recently moved).&lt;/p&gt;

&lt;p&gt;由于收集分区用于重新分配的随机性质，上述过程并不总是perfectly rebalance a ring。为了帮助达到更平衡的环，rebalance过程重复固定次数，直到replica-plan实现或无法实现（表明由于最近移动的分区太多，我们可能无法get perfect balance）。&lt;/p&gt;

&lt;h2 id=&#34;composite-rings-module-swift-common-ring-composite-builder-permalink-to-this-headline&#34;&gt;Composite Rings&lt;a href=&#34;#module-swift.common.ring.composite_builder&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;A standard ring built using the &lt;a href=&#34;#ring-builder&#34;&gt;ring-builder&lt;/a&gt; will attempt to randomly disperse replicas or erasure-coded fragments across failure domains, but does not provide any guarantees such as placing at least one replica of every partition into each region. Composite rings are intended to provide operators with greater control over the dispersion of object replicas or fragments across a cluster, in particular when there is a desire to have strict guarantees that some replicas or fragments are placed in certain failure domains. This is particularly important for policies with duplicated erasure-coded fragments.&lt;/p&gt;

&lt;p&gt;使用&lt;a href=&#34;#ring-builder&#34;&gt;ring-builder&lt;/a&gt;构建的标准环将尝试跨越故障域随机分散副本或擦除编码的片段，但不提供任何保证，例如将每个分区的至少一个副本放置到每个region中。复合环（Composite rings）旨在为操作员提供对跨群集的对象replicas或fragments的分散的更大控制，特别是当希望严格保证某些复制品或片段放置在某些故障域中时。这对于具有重复的擦除编码片段的策略尤其重要。&lt;/p&gt;

&lt;p&gt;A composite ring comprises two or more component rings that are combined to form a single ring with a replica count equal to the sum of replica counts from the component rings. The component rings are built independently, using distinct devices in distinct regions, which means that the dispersion of replicas between the components can be guaranteed. The &lt;code&gt;composite_builder&lt;/code&gt; utilities may then be used to combine components into a composite ring.&lt;/p&gt;

&lt;p&gt;复合环包括两个或更多个组件环，这些组件环被组合以形成单个环，其复制计数等于来自组件环的复制计数的总和。组件环是独立构建的，使用不同区域中的不同设备，这意味着可以保证组件之间的复制品的分散。composite_builder 然后可以使用这些实用程序将组件组合成复合环。&lt;/p&gt;

&lt;p&gt;For example, consider a normal ring &lt;code&gt;ring0&lt;/code&gt; with replica count of 4 and devices in two regions &lt;code&gt;r1&lt;/code&gt; and &lt;code&gt;r2&lt;/code&gt;. Despite the best efforts of the ring-builder, it is possible for there to be three replicas of a particular partition placed in one region and only one replica placed in the other region. For example:&lt;/p&gt;

&lt;p&gt;例如，考虑一个正常的环ring0为4副本计数和在两个区域的设备r1和r2。尽管环构建器做了最大努力，但是有可能在一个区域中放置三个特定分区的复制品，而在另一个区域中只放置一个复制品。例如：&lt;/p&gt;

&lt;p&gt;part_n -&amp;gt; r1z1h110/sdb r1z2h12/sdb r1z3h13/sdb r2z1h21/sdb&lt;/p&gt;

&lt;p&gt;Now consider two normal rings each with replica count of 2: &lt;code&gt;ring1&lt;/code&gt; has devices in only &lt;code&gt;r1&lt;/code&gt;; &lt;code&gt;ring2&lt;/code&gt; has devices in only &lt;code&gt;r2&lt;/code&gt;. When these rings are combined into a composite ring then every partition is guaranteed to be mapped to two devices in each of &lt;code&gt;r1&lt;/code&gt; and &lt;code&gt;r2&lt;/code&gt;, for example:&lt;/p&gt;

&lt;p&gt;part_n -&amp;gt; r1z1h10/sdb r1z2h20/sdb  r2z1h21/sdb r2z2h22/sdb
          |_____________________|  |_____________________|
                     |                        |
                   ring1                    ring2&lt;/p&gt;

&lt;p&gt;The dispersion of partition replicas across failure domains within each of the two component rings may change as they are modified and rebalanced, but the dispersion of replicas between the two regions is guaranteed by the use of a composite ring.&lt;/p&gt;

&lt;p&gt;For rings to be formed into a composite they must satisfy the following requirements:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;All component rings must have the same part power (and therefore number of partitions)&lt;/li&gt;
&lt;li&gt;All component rings must have an integer replica count&lt;/li&gt;
&lt;li&gt;Each region may only be used in one component ring&lt;/li&gt;
&lt;li&gt;Each device may only be used in one component ring&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Under the hood, the composite ring has a &lt;code&gt;_replica2part2dev_id&lt;/code&gt; table that is the union of the tables from the component rings. Whenever the component rings are rebalanced, the composite ring must be rebuilt. There is no dynamic rebuilding of the composite ring.&lt;/p&gt;

&lt;p&gt;Note&lt;/p&gt;

&lt;p&gt;The order in which component rings are combined into a composite ring is very significant because it determines the order in which the Ring.get_part_nodes() method will provide primary nodes for the composite ring and consequently the node indexes assigned to the primary nodes. For an erasure-coded policy, inadvertent changes to the primary node indexes could result in large amounts of data movement due to fragments being moved to their new correct primary.&lt;/p&gt;

&lt;p&gt;The &lt;code&gt;id&lt;/code&gt; of each component RingBuilder is therefore stored in metadata of the composite and used to check for the component ordering when the same composite ring is re-composed. RingBuilder &lt;code&gt;id&lt;/code&gt;s are normally assigned when a RingBuilder instance is first saved. Older RingBuilder instances loaded from file may not have an &lt;code&gt;id&lt;/code&gt; assigned and will need to be saved before they can be used as components of a composite ring. This can be achieved by, for example:&lt;/p&gt;

&lt;p&gt;swift-ring-builder &lt;builder\-file\&gt; rebalance --force&lt;/p&gt;

&lt;h2 id=&#34;ring-builder-analyzer-module-swift-cli-ring-builder-analyzer-permalink-to-this-headline&#34;&gt;Ring Builder Analyzer&lt;a href=&#34;#module-swift.cli.ring_builder_analyzer&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;This is a tool for analyzing how well the ring builder performs its job in a particular scenario. It is intended to help developers quantify any improvements or regressions in the ring builder; it is probably not useful to others.&lt;/p&gt;

&lt;p&gt;The ring builder analyzer takes a scenario file containing some initial parameters for a ring builder plus a certain number of rounds. In each round, some modifications are made to the builder, e.g. add a device, remove a device, change a device’s weight. Then, the builder is repeatedly rebalanced until it settles down. Data about that round is printed, and the next round begins.&lt;/p&gt;

&lt;p&gt;Scenarios are specified in JSON. Example scenario for a gradual device addition:&lt;/p&gt;

&lt;p&gt;{
    &amp;ldquo;part_power&amp;rdquo;: 12,
    &amp;ldquo;replicas&amp;rdquo;: 3,
    &amp;ldquo;overload&amp;rdquo;: 0.1,
    &amp;ldquo;random_seed&amp;rdquo;: 203488,&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;span class=&#34;lnt&#34;&gt; 1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 2
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 3
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 4
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 5
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 6
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 7
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 8
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt; 9
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;10
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;11
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;12
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;13
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;14
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;15
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;16
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;17
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;18
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;19
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;20
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;21
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;22
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;23
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;24
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;25
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;26
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;27
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;28
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;29
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;30
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;31
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;32
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;33
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;34
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;35
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;36
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;37
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;38
&lt;/span&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&amp;#34;rounds&amp;#34;: \[
    \[
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.40:6200/sda&amp;#34;, 8000\],
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.40:6200/sdb&amp;#34;, 8000\],
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.40:6200/sdc&amp;#34;, 8000\],
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.40:6200/sdd&amp;#34;, 8000\],

        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.41:6200/sda&amp;#34;, 8000\],
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.41:6200/sdb&amp;#34;, 8000\],
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.41:6200/sdc&amp;#34;, 8000\],
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.41:6200/sdd&amp;#34;, 8000\],

        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.43:6200/sda&amp;#34;, 8000\],
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.43:6200/sdb&amp;#34;, 8000\],
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.43:6200/sdc&amp;#34;, 8000\],
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.43:6200/sdd&amp;#34;, 8000\],

        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.44:6200/sda&amp;#34;, 8000\],
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.44:6200/sdb&amp;#34;, 8000\],
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.44:6200/sdc&amp;#34;, 8000\]
    \], \[
        \[&amp;#34;add&amp;#34;, &amp;#34;r1z2-10.20.30.44:6200/sdd&amp;#34;, 1000\]
    \], \[
        \[&amp;#34;set\_weight&amp;#34;, 15, 2000\]
    \], \[
        \[&amp;#34;remove&amp;#34;, 3\],
        \[&amp;#34;set\_weight&amp;#34;, 15, 3000\]
    \], \[
        \[&amp;#34;set\_weight&amp;#34;, 15, 4000\]
    \], \[
        \[&amp;#34;set\_weight&amp;#34;, 15, 5000\]
    \], \[
        \[&amp;#34;set\_weight&amp;#34;, 15, 6000\]
    \], \[
        \[&amp;#34;set\_weight&amp;#34;, 15, 7000\]
    \], \[
        \[&amp;#34;set\_weight&amp;#34;, 15, 8000\]
    \]\]&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;}&lt;/p&gt;

&lt;h2 id=&#34;history-history-permalink-to-this-headline&#34;&gt;History&lt;a href=&#34;#history&#34; title=&#34;Permalink to this headline&#34;&gt;¶&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;The ring code went through many iterations before arriving at what it is now and while it has largely been stable, the algorithm has seen a few tweaks or perhaps even fundamentally changed as new ideas emerge. This section will try to describe the previous ideas attempted and attempt to explain why they were discarded.&lt;/p&gt;

&lt;p&gt;A “live ring” option was considered where each server could maintain its own copy of the ring and the servers would use a gossip protocol to communicate the changes they made. This was discarded as too complex and error prone to code correctly in the project timespan available. One bug could easily gossip bad data out to the entire cluster and be difficult to recover from. Having an externally managed ring simplifies the process, allows full validation of data before it’s shipped out to the servers, and guarantees each server is using a ring from the same timeline. It also means that the servers themselves aren’t spending a lot of resources maintaining rings.&lt;/p&gt;

&lt;p&gt;A couple of “ring server” options were considered. One was where all ring lookups would be done by calling a service on a separate server or set of servers, but this was discarded due to the latency involved. Another was much like the current process but where servers could submit change requests to the ring server to have a new ring built and shipped back out to the servers. This was discarded due to project time constraints and because ring changes are currently infrequent enough that manual control was sufficient. However, lack of quick automatic ring changes did mean that other components of the system had to be coded to handle devices being unavailable for a period of hours until someone could manually update the ring.&lt;/p&gt;

&lt;p&gt;The current ring process has each replica of a partition independently assigned to a device. A version of the ring that used a third of the memory was tried, where the first replica of a partition was directly assigned and the other two were determined by “walking” the ring until finding additional devices in other zones. This was discarded due to the loss of control over how many replicas for a given partition moved at once. Keeping each replica independent allows for moving only one partition replica within a given time window (except due to device failures). Using the additional memory was deemed a good trade-off for moving data around the cluster much less often.&lt;/p&gt;

&lt;p&gt;Another ring design was tried where the partition to device assignments weren’t stored in a big list in memory but instead each device was assigned a set of hashes, or anchors. The partition would be determined from the data item’s hash and the nearest device anchors would determine where the replicas should be stored. However, to get reasonable distribution of data each device had to have a lot of anchors and walking through those anchors to find replicas started to add up. In the end, the memory savings wasn’t that great and more processing power was used, so the idea was discarded.&lt;/p&gt;

&lt;p&gt;A completely non-partitioned ring was also tried but discarded as the partitioning helps many other components of the system, especially replication. Replication can be attempted and retried in a partition batch with the other replicas rather than each data item independently attempted and retried. Hashes of directory structures can be calculated and compared with other replicas to reduce directory walking and network traffic.&lt;/p&gt;

&lt;p&gt;Partitioning and independently assigning partition replicas also allowed for the best-balanced cluster. The best of the other strategies tended to give ±10% variance on device balance with devices of equal weight and ±15% with devices of varying weights. The current strategy allows us to get ±3% and ±8% respectively.&lt;/p&gt;

&lt;p&gt;Various hashing algorithms were tried. SHA offers better security, but the ring doesn’t need to be cryptographically secure and SHA is slower. Murmur was much faster, but MD5 was built-in and hash computation is a small percentage of the overall request handling time. In all, once it was decided the servers wouldn’t be maintaining the rings themselves anyway and only doing hash lookups, MD5 was chosen for its general availability, good distribution, and adequate speed.&lt;/p&gt;

&lt;p&gt;The placement algorithm has seen a number of behavioral changes for unbalanceable rings. The ring builder wants to keep replicas as far apart as possible while still respecting device weights. In most cases, the ring builder can achieve both, but sometimes they conflict. At first, the behavior was to keep the replicas far apart and ignore device weight, but that made it impossible to gradually go from one region to two, or from two to three. Then it was changed to favor device weight over dispersion, but that wasn’t so good for rings that were close to balanceable, like 3 machines with 60TB, 60TB, and 57TB of disk space; operators were expecting one replica per machine, but didn’t always get it. After that, overload was added to the ring builder so that operators could choose a balance between dispersion and device weights. In time the overload concept was improved and made more accurate.&lt;/p&gt;

&lt;p&gt;For more background on consistent hashing rings, please see &lt;a href=&#34;ring_background.html&#34;&gt;Building a Consistent Hashing Ring&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;updated: 2019-01-15 02:30&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://creativecommons.org/licenses/by/3.0/&#34;&gt;&lt;img src=&#34;_static/images/docs/license.png&#34; alt=&#34;Creative Commons Attribution 3.0 License&#34; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Except where otherwise noted, this document is licensed under &lt;a href=&#34;https://creativecommons.org/licenses/by/3.0/&#34;&gt;Creative Commons Attribution 3.0 License&lt;/a&gt;. See all &lt;a href=&#34;http://www.openstack.org/legal&#34;&gt;OpenStack Legal Documents&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;#&#34;&gt;found an error? report a bug&lt;/a&gt; &lt;a href=&#34;http://ask.openstack.org&#34;&gt;questions?&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;OpenStack Documentation&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Guides&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/index.html#install-guides&#34;&gt;Install Guides&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/index.html#user-guides&#34;&gt;User Guides&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/index.html#configuration-guides&#34;&gt;Configuration Guides&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/index.html#ops-and-admin-guides&#34;&gt;Operations and Administration Guides&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/index.html#api-guides&#34;&gt;API Guides&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/index.html#contributor-guides&#34;&gt;Contributor Guides&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Languages&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/de/&#34;&gt;Deutsch (German)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/fr/&#34;&gt;Français (French)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/id/&#34;&gt;Bahasa Indonesia (Indonesian)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/it/&#34;&gt;Italiano (Italian)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/ja/&#34;&gt;日本語 (Japanese)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/ko_KR/&#34;&gt;한국어 (Korean)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/pt_BR/&#34;&gt;Português (Portuguese)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/tr_TR/&#34;&gt;Türkçe (Türkiye)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/zh_CN/&#34;&gt;简体中文 (Simplified Chinese)&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;[&lt;/p&gt;

&lt;h4 id=&#34;swift-2-17-1-dev19&#34;&gt;swift 2.17.1.dev19&lt;/h4&gt;

&lt;p&gt;](index.html)&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&#34;getting_started.html&#34;&gt;Getting Started&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;api/object_api_v1_overview.html&#34;&gt;Object Storage API overview&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_architecture.html&#34;&gt;Swift Architectural Overview&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;#&#34;&gt;The Rings&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#ring-builder&#34;&gt;Ring Builder&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#ring-data-structure&#34;&gt;Ring Data Structure&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#partition-replica-terminology&#34;&gt;Partition &amp;amp; Replica Terminology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#building-the-ring&#34;&gt;Building the Ring&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#module-swift.common.ring.composite_builder&#34;&gt;Composite Rings&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#module-swift.cli.ring_builder_analyzer&#34;&gt;Ring Builder Analyzer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#history&#34;&gt;History&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_policies.html&#34;&gt;Storage Policies&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_reaper.html&#34;&gt;The Account Reaper&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_auth.html&#34;&gt;The Auth System&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_acl.html&#34;&gt;Access Control Lists (ACLs)&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_replication.html&#34;&gt;Replication&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;ratelimit.html&#34;&gt;Rate Limiting&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_large_objects.html&#34;&gt;Large Object Support&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_object_versioning.html&#34;&gt;Object Versioning&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_global_cluster.html&#34;&gt;Global Clusters&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_container_sync.html&#34;&gt;Container to Container Synchronization&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_expiring_objects.html&#34;&gt;Expiring Object Support&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;cors.html&#34;&gt;CORS&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;crossdomain.html&#34;&gt;Cross-domain Policy File&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_erasure_code.html&#34;&gt;Erasure Code Support&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_encryption.html&#34;&gt;Object Encryption&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;overview_backing_store.html&#34;&gt;Using Swift as Backing Store for Service Data&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;ring_background.html&#34;&gt;Building a Consistent Hashing Ring&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;ring_partpower.html&#34;&gt;Modifying Ring Partition Power&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;associated_projects.html&#34;&gt;Associated Projects&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;development_guidelines.html&#34;&gt;Development Guidelines&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;development_saio.html&#34;&gt;SAIO - Swift All In One&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;first_contribution_swift.html&#34;&gt;First Contribution to Swift&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;policies_saio.html&#34;&gt;Adding Storage Policies to an Existing SAIO&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;development_auth.html&#34;&gt;Auth Server and Middleware&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;development_middleware.html&#34;&gt;Middleware and Metadata&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;development_ondisk_backends.html&#34;&gt;Pluggable On-Disk Back-end APIs&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;howto_installmultinode.html&#34;&gt;Instructions for a Multiple Server Swift Installation&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;deployment_guide.html&#34;&gt;Deployment Guide&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;apache_deployment_guide.html&#34;&gt;Apache Deployment Guide&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;admin_guide.html&#34;&gt;Administrator’s Guide&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;replication_network.html&#34;&gt;Dedicated replication network&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;logs.html&#34;&gt;Logs&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;ops_runbook/index.html&#34;&gt;Swift Ops Runbook&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;admin/index.html&#34;&gt;OpenStack Swift Administrator Guide&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;install/index.html&#34;&gt;Object Storage Install Guide&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;api/object_api_v1_overview.html&#34;&gt;Object Storage API overview&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;api/discoverability.html&#34;&gt;Discoverability&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;api/authentication.html&#34;&gt;Authentication&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;api/container_quotas.html&#34;&gt;Container quotas&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;api/object_versioning.html&#34;&gt;Object versioning&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;api/large_objects.html&#34;&gt;Large objects&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;api/temporary_url_middleware.html&#34;&gt;Temporary URL middleware&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;api/form_post_middleware.html&#34;&gt;Form POST middleware&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;api/use_content-encoding_metadata.html&#34;&gt;Use Content-Encoding metadata&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;api/use_the_content-disposition_metadata.html&#34;&gt;Use the Content-Disposition metadata&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;ring.html&#34;&gt;Partitioned Consistent Hash Ring&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;proxy.html&#34;&gt;Proxy&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;account.html&#34;&gt;Account&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;container.html&#34;&gt;Container&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;db.html&#34;&gt;Account DB and Container DB&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;object.html&#34;&gt;Object&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;misc.html&#34;&gt;Misc&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;a href=&#34;middleware.html&#34;&gt;Middleware&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;page-contents&#34;&gt;Page Contents&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#&#34;&gt;The Rings&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#ring-builder&#34;&gt;Ring Builder&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#ring-data-structure&#34;&gt;Ring Data Structure&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;#list-of-devices&#34;&gt;List of Devices&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#partition-assignment-list&#34;&gt;Partition Assignment List&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#partition-shift-value&#34;&gt;Partition Shift Value&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#fractional-replicas&#34;&gt;Fractional Replicas&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#dispersion&#34;&gt;Dispersion&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#overload&#34;&gt;Overload&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#partition-replica-terminology&#34;&gt;Partition &amp;amp; Replica Terminology&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#building-the-ring&#34;&gt;Building the Ring&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#module-swift.common.ring.composite_builder&#34;&gt;Composite Rings&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#module-swift.cli.ring_builder_analyzer&#34;&gt;Ring Builder Analyzer&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#history&#34;&gt;History&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;openstack&#34;&gt;OpenStack&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/projects/&#34;&gt;Projects&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/projects/openstack-security/&#34;&gt;OpenStack Security&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/projects/openstack-faq/&#34;&gt;Common Questions&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/blog/&#34;&gt;Blog&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/news/&#34;&gt;News&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;community&#34;&gt;Community&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/community/&#34;&gt;User Groups&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/community/events/&#34;&gt;Events&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/community/jobs/&#34;&gt;Jobs&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/foundation/companies/&#34;&gt;Companies&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org/infra/manual/developers.html&#34;&gt;Contribute&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;documentation&#34;&gt;Documentation&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://docs.openstack.org&#34;&gt;OpenStack Manuals&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/software/start/&#34;&gt;Getting Started&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://developer.openstack.org&#34;&gt;API Documentation&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.openstack.org&#34;&gt;Wiki&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;branding-legal&#34;&gt;Branding &amp;amp; Legal&lt;/h3&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/brand/&#34;&gt;Logos &amp;amp; Guidelines&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/brand/openstack-trademark-policy/&#34;&gt;Trademark Policy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://openstack.org/privacy/&#34;&gt;Privacy Policy&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://wiki.openstack.org/wiki/How_To_Contribute#Contributor_License_Agreement&#34;&gt;OpenStack CLA&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;stay-in-touch&#34;&gt;Stay In Touch&lt;/h3&gt;

&lt;p&gt;[](&lt;a href=&#34;https://twitter.com/OpenStack)[](https://www.facebook.com/openstack)[](https://www.linkedin.com/company/openstack)[](https://www.youtube.com/user/OpenStackFoundation&#34;&gt;https://twitter.com/OpenStack)[](https://www.facebook.com/openstack)[](https://www.linkedin.com/company/openstack)[](https://www.youtube.com/user/OpenStackFoundation&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;The OpenStack project is provided under the &lt;a href=&#34;http://www.apache.org/licenses/LICENSE-2.0&#34;&gt;Apache 2.0 license&lt;/a&gt;. Openstack.org is powered by &lt;a href=&#34;http://rackspace.com&#34;&gt;Rackspace Cloud Computing&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;var DOCUMENTATION_OPTIONS = { URL_ROOT: &amp;lsquo;./&amp;rsquo;, VERSION: &amp;lsquo;2.17.1.dev19&amp;rsquo;, COLLAPSE_INDEX: false, FILE_SUFFIX: &amp;lsquo;.html&amp;rsquo;, SOURCELINK_SUFFIX: &amp;lsquo;.txt&amp;rsquo;, HAS_SOURCE: true }; /* build a description of this page including SHA, source location on git repo, build time and the project&amp;rsquo;s launchpad bug tag. Set the HREF of the bug buttons */ var lineFeed = &amp;ldquo;%0A&amp;rdquo;; var gitURL = &amp;ldquo;Source: Can&amp;rsquo;t derive source file URL&amp;rdquo;; /* there have been cases where &amp;ldquo;pagename&amp;rdquo; wasn&amp;rsquo;t set; better check for it */ /* &amp;ldquo;giturl&amp;rdquo; is the URL of the source file on Git and is auto-generated by openstackdocstheme. &amp;ldquo;pagename&amp;rdquo; is a standard sphinx parameter containing the name of the source file, without extension. */ var sourceFile = &amp;ldquo;overview_ring&amp;rdquo; + &amp;ldquo;.rst&amp;rdquo;; gitURL = &amp;ldquo;Source: &lt;a href=&#34;https://git.openstack.org/cgit/openstack/swift/tree/doc/source&amp;quot;&#34;&gt;https://git.openstack.org/cgit/openstack/swift/tree/doc/source&amp;quot;&lt;/a&gt; + &amp;ldquo;/&amp;rdquo; + sourceFile; /* gitsha, project and bug_tag rely on variables in conf.py */ var gitSha = &amp;ldquo;SHA: 4ea52f3a950b5db1bb0549de322e252471218401&amp;rdquo;; var bugProject = &amp;ldquo;swift&amp;rdquo;; var bugTitle = &amp;ldquo;The Rings in swift&amp;rdquo;; var fieldTags = &amp;ldquo;&amp;rdquo;; var useStoryboard = &amp;ldquo;&amp;rdquo;; /* &amp;ldquo;last_updated&amp;rdquo; is the build date and time. It relies on the conf.py variable &amp;ldquo;html_last_updated_fmt&amp;rdquo;, which should include year/month/day as well as hours and minutes */ var buildstring = &amp;ldquo;Release: 2.17.1.dev19 on 2019-01-15 02:30&amp;rdquo;; var fieldComment = encodeURI(buildstring) + lineFeed + encodeURI(gitSha) + lineFeed + encodeURI(gitURL) ; logABug(bugTitle, bugProject, fieldComment, fieldTags); $(document).ready(function(){ $.ajax({ context: this, dataType : &amp;ldquo;html&amp;rdquo;, url : &amp;ldquo;&lt;a href=&#34;https://docs.openstack.org/queens/badge.html&amp;quot;&#34;&gt;https://docs.openstack.org/queens/badge.html&amp;quot;&lt;/a&gt;, success : function(results) { $(&amp;lsquo;#deprecated-badge-container&amp;rsquo;).html(results); } }); });&lt;/p&gt;
</description>
      
    </item>
    
    <item>
      <title>Can scp create a directory if it doesn&#39;t exist?</title>
      <link>https://b.qqbb.app/post/can-scp-create-a-directory-if-it-doesnt-exist/</link>
      <pubDate>Sat, 19 Jan 2019 00:00:00 -0800</pubDate>
      <author>273412935@qq.com (龙哥)</author>
      <guid>https://b.qqbb.app/post/can-scp-create-a-directory-if-it-doesnt-exist/</guid>
      
        <description>

&lt;p&gt;Can scp create a directory if it doesn&amp;rsquo;t exist?&lt;/p&gt;

&lt;p&gt;As far as I know, scp itself cannot do that, no. However, you could just ssh to the target machine, create the directory and then copy. Something like:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;span class=&#34;lnt&#34;&gt;2
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;ssh user@host &lt;span class=&#34;s2&#34;&gt;&amp;#34;mkdir -p /target/path/&amp;#34;&lt;/span&gt; &lt;span class=&#34;o&#34;&gt;&amp;amp;&amp;amp;&lt;/span&gt;
      scp /path/to/source user@host:/target/path/&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;Note that if you are copying entire directories, the above is not needed. For example, to copy the directory ~/foo to the remote host, you could use the -r (recursive) flag:&lt;/p&gt;
&lt;div class=&#34;highlight&#34;&gt;&lt;div class=&#34;chroma&#34;&gt;
&lt;table class=&#34;lntable&#34;&gt;&lt;tr&gt;&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;&lt;span class=&#34;lnt&#34;&gt;1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;
&lt;td class=&#34;lntd&#34;&gt;
&lt;pre class=&#34;chroma&#34;&gt;&lt;code class=&#34;language-shell&#34; data-lang=&#34;shell&#34;&gt;scp ~/foo/ user@host:~/&lt;/code&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;p&gt;That will create the target directory ~/foo on the remote host.
However, it can&amp;rsquo;t create the parent directory. scp ~/foo user@host:~/bar/foo will fail unless the target directory bar exists.
In any case, the -r flag won&amp;rsquo;t help create a target directory if you are copying individual files.&lt;/p&gt;

&lt;h2 id=&#34;ref&#34;&gt;Ref&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://unix.stackexchange.com/questions/193368/can-scp-create-a-directory-if-it-doesnt-exist&#34;&gt;https://unix.stackexchange.com/questions/193368/can-scp-create-a-directory-if-it-doesnt-exist&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
      
    </item>
    
  </channel>
</rss>